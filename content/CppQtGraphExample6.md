

[Go back to Richel Bilderbeek's C++ page](Cpp.htm).

 

 

 

 

 

([C++](Cpp.htm)) [QtGraphExample6](CppQtGraphExample6.htm)
==========================================================

 

Technical facts
---------------

 

[Operating system(s) or programming environment(s)](CppOs.htm)

-   ![Lubuntu](PicLubuntu.png) [Lubuntu](CppLubuntu.htm) 15.04 (vivid)

[IDE(s)](CppIde.htm):

-   ![Qt Creator](PicQtCreator.png) [Qt Creator](CppQtCreator.htm) 3.1.1

[Project type](CppQtProjectType.htm):

-   ![console](PicConsole.png) [Console
    application](CppConsoleApplication.htm)

[C++ standard](CppStandard.htm):

-   ![C++98](PicCpp98.png) [C++98](Cpp98.htm)

[Compiler(s)](CppCompiler.htm):

-   [G++](CppGpp.htm) 4.9.2

[Libraries](CppLibrary.htm) used:

-   ![STL](PicStl.png) [STL](CppStl.htm): GNU ISO C++ Library, version
    4.9.2

 

 

 

 

 

[Qt project file](CppQtProjectFile.htm): ./CppQtGraphExample6/CppQtGraphExample6.pro
------------------------------------------------------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` include(../../DesktopApplication.pri) include(../../Libraries/Boost.pri)  SOURCES += \     edge.cpp \     graphwidget.cpp \     main.cpp \     node.cpp \     popup.cpp  HEADERS += \     edge.h \     graphwidget.h \     node.h \     popup.h`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/edge.h
---------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #ifndef EDGE_H #define EDGE_H  #include <QGraphicsItem>  class Node;  class Edge : public QGraphicsItem { public:   Edge(Node * const source_node, Node * const dest_node);   Edge(const Edge&) = delete;   Edge& operator=(const Edge&) = delete;    Node * sourceNode() const noexcept;   Node * destNode() const noexcept;    void adjust() noexcept;    enum { Type = UserType + 2 };   int type() const { return Type; }  protected:   QRectF boundingRect() const;   void paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *widget);  private:   const double m_arrow_size;   Node * const m_dest_node;   QPointF m_dest_point;   bool m_show_bounding_rect;   Node * const m_source_node;   QPointF m_source_point; };   #endif`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/edge.cpp
-----------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html #include "edge.h"   #include <QPainter> #include <QStyleOption> #include "node.h"  #include <boost/math/constants/constants.hpp>  Edge::Edge(Node * const source_node, Node * const dest_node)   :     m_arrow_size{10.0},     m_dest_node{dest_node},     m_dest_point{0.0,0.0},     m_show_bounding_rect{false},     m_source_node{source_node},     m_source_point{0.0,0.0} {   this->setFlags(       ItemIsFocusable     | ItemIsSelectable   );   m_source_node->addEdge(this);   m_dest_node->addEdge(this);   adjust(); }  Node * Edge::sourceNode() const noexcept {   return m_source_node; }  Node * Edge::destNode() const noexcept {   return m_dest_node; }  void Edge::adjust() noexcept {   if (!m_source_node || !m_dest_node) return;    const QLineF line(mapFromItem(m_source_node, 0, 0), mapFromItem(m_dest_node, 0, 0));   const double length{line.length()};    prepareGeometryChange();    if (length > 20.0)   {     const QPointF edgeOffset((line.dx() * 10) / length, (line.dy() * 10) / length);     m_source_point = line.p1() + edgeOffset;     m_dest_point = line.p2() - edgeOffset;   }   else   {     m_source_point = m_dest_point = line.p1();   } }  QRectF Edge::boundingRect() const {   if (!m_source_node || !m_dest_node) return QRectF();    const double penWidth{1.0};   const double extra{(penWidth + m_arrow_size) / 2.0};    return QRectF(     m_source_point,     QSizeF(m_dest_point.x() - m_source_point.x(),       m_dest_point.y() - m_source_point.y()     )   ).normalized()    .adjusted(-extra, -extra, extra, extra); }  void Edge::paint(QPainter *painter, const QStyleOptionGraphicsItem * option, QWidget *) {   if (!m_source_node || !m_dest_node) return;    const double pi{boost::math::constants::pi<double>()};   const double tau{boost::math::constants::two_pi<double>()};     const QLineF line(m_source_point, m_dest_point);    if (qFuzzyCompare(line.length(), 0.0)) return;    // Draw the line itself   const bool is_selected{option->state & QStyle::State_Sunken || isSelected()};   painter->setPen(     QPen(       Qt::black,       1.0,       is_selected ? Qt::DashLine : Qt::SolidLine,       Qt::RoundCap,       Qt::RoundJoin     )   );   painter->drawLine(line);    painter->setPen(     QPen(       Qt::black,       1.0,       Qt::SolidLine, //The point must be drawn with solidLine       Qt::RoundCap,       Qt::RoundJoin     )   );    // Draw the arrows   double angle = std::acos(line.dx() / line.length());   if (line.dy() >= 0) angle = tau - angle;    using std::sin;   using std::cos;   const QPointF sourceArrowP1{m_source_point + QPointF(sin(angle + pi / 3.0) * m_arrow_size,cos(angle + pi / 3.0) * m_arrow_size)};   const QPointF sourceArrowP2{m_source_point + QPointF(sin(angle + pi - pi / 3.0) * m_arrow_size,cos(angle + pi - pi / 3.0) * m_arrow_size)};   const QPointF destArrowP1{m_dest_point + QPointF(sin(angle - pi / 3.0) * m_arrow_size,cos(angle - pi / 3.0) * m_arrow_size)};   const QPointF destArrowP2{m_dest_point + QPointF(sin(angle - pi + pi / 3.0) * m_arrow_size,cos(angle - pi + pi / 3.0) * m_arrow_size)};    painter->setBrush(Qt::black);   painter->drawPolygon(QPolygonF() << line.p1() << sourceArrowP1 << sourceArrowP2);   painter->drawPolygon(QPolygonF() << line.p2() << destArrowP1 << destArrowP2);    //Draw the bounding rectangle   if (m_show_bounding_rect)   {     painter->setBrush(QBrush(QColor(0,0,255,32)));     painter->setPen(QPen(QColor(0,0,255,64)));     painter->drawRect(this->boundingRect());   } }`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/graphwidget.h
----------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #ifndef GRAPHWIDGET_H #define GRAPHWIDGET_H  #include <QGraphicsView>  class Node; class PopUp;  class GraphWidget : public QGraphicsView {   Q_OBJECT  public:   GraphWidget(QWidget *parent = 0);   GraphWidget(const GraphWidget&) = delete;   GraphWidget& operator=(const GraphWidget&) = delete;    ///Create a new node. The Node* is managed by GraphWidget   Node* createNode() noexcept;    void itemMoved() noexcept;  public slots:   void shuffle() noexcept;   void zoomIn() noexcept;   void zoomOut() noexcept;  protected:   void keyPressEvent(QKeyEvent *event) noexcept override;   void scaleView(qreal scaleFactor) noexcept;   void timerEvent(QTimerEvent *event) noexcept override;   void wheelEvent(QWheelEvent *event) noexcept override;  private:   int m_timer_id;   PopUp * const m_popup;   void OnNodeFocusInEvent(Node* const node) noexcept;   void OnNodeFocusOutEvent(Node* const node) noexcept;   void OnNodePositionChangedEvent(Node* const node) noexcept;   void OnPopUpClicked(PopUp* const popup) noexcept; };  #endif`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/graphwidget.cpp
------------------------------------

 

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #include "graphwidget.h" #include <cmath>  #include <boost/lambda/lambda.hpp>  #include <QApplication> #include <QDesktopWidget> #include <QGraphicsRectItem> #include <QGraphicsScene> #include <QKeyEvent>  #include "edge.h" #include "node.h" #include "popup.h"  GraphWidget::GraphWidget(QWidget *parent) : QGraphicsView(parent),   m_timer_id{0},   m_popup{new PopUp} //Will be owned by scene {   QGraphicsScene * const scene = new QGraphicsScene(this);   scene->addItem(m_popup); //Transfer ownership   m_popup->setRect(-8.0,-8.0,16.0,16.0);   m_popup->setVisible(false);   m_popup->m_signal_clicked.connect(     boost::bind(&GraphWidget::OnPopUpClicked,this, boost::lambda::_1)   );    scene->setItemIndexMember function(QGraphicsScene::NoIndex);   setScene(scene);   setCacheMode(CacheBackground);   setViewportUpdateMode(BoundingRectViewportUpdate);   setRenderHint(QPainter::Antialiasing);   setTransformationAnchor(AnchorUnderMouse);   scale(3.0,3.0);    std::vector<Node*> nodes;   for (int y=-1; y!=2; ++y)   {     for (int x=-1; x!=2; ++x)     {       const auto node = createNode();       node->setPos(static_cast<double>(x) * 50.0, static_cast<double>(y) * 50.0);       nodes.push_back(node);     }    }   //m_active_node = nodes[4];   scene->addItem(new Edge(nodes[0],nodes[1]));   scene->addItem(new Edge(nodes[0],nodes[3]));   scene->addItem(new Edge(nodes[1],nodes[2]));   scene->addItem(new Edge(nodes[1],nodes[4]));   scene->addItem(new Edge(nodes[2],nodes[5]));   scene->addItem(new Edge(nodes[3],nodes[4]));   scene->addItem(new Edge(nodes[3],nodes[6]));   scene->addItem(new Edge(nodes[4],nodes[5]));   scene->addItem(new Edge(nodes[4],nodes[7]));   scene->addItem(new Edge(nodes[5],nodes[8]));   scene->addItem(new Edge(nodes[6],nodes[7]));   scene->addItem(new Edge(nodes[7],nodes[8]));    {     //Put the dialog, at size 80%, in the screen center     const QRect screen = QApplication::desktop()->screenGeometry();     this->setGeometry(0,0,screen.width() * 8 / 10, screen.height() * 8 / 10);     this->move( screen.center() - this->rect().center() );   } }  Node* GraphWidget::createNode() noexcept {   Node * const new_node{new Node(this)};   new_node->m_signal_focus_in.connect(     boost::bind(&GraphWidget::OnNodeFocusInEvent,this, boost::lambda::_1)   );   new_node->m_signal_focus_out.connect(     boost::bind(&GraphWidget::OnNodeFocusOutEvent,this, boost::lambda::_1)   );   new_node->m_signal_position_changed.connect(     boost::bind(&GraphWidget::OnNodePositionChangedEvent,this, boost::lambda::_1)   );   this->scene()->addItem(new_node);   return new_node; }  void GraphWidget::itemMoved() noexcept {   if (!m_timer_id)   {     m_timer_id = startTimer(1000 / 25);   } }  void GraphWidget::keyPressEvent(QKeyEvent *event) noexcept {   std::vector<Node*> nodes;   foreach(QGraphicsItem * const item, scene()->selectedItems())   {     Node * const node{dynamic_cast<Node*>(item)};     if (node) nodes.push_back(node);   }    switch (event->key())   {     case Qt::Key_Up:     {       foreach(Node * const node, nodes) { node->moveBy(0.0,-20.0); }     }     break;     case Qt::Key_Down:     {       foreach(Node * const node, nodes) { node->moveBy(0.0,20.0); }     }     break;     case Qt::Key_Left:     {       foreach(Node * const node, nodes) { node->moveBy(-20.0,0.0); }     }     break;     case Qt::Key_Right:     {       foreach(Node * const node, nodes) { node->moveBy(20,0); }     }     break;     case Qt::Key_Plus:       zoomIn();     break;     case Qt::Key_Minus:       zoomOut();     break;     case Qt::Key_Space:     case Qt::Key_Enter:       shuffle();     break;     default:       QGraphicsView::keyPressEvent(event);   } }  void GraphWidget::OnNodeFocusInEvent(Node* const node) noexcept {   assert(node);   m_popup->StartFadeIn();   m_popup->SetNode(node);   m_popup->setPos(node->pos() + QPointF(25.0,-25.0)); }  void GraphWidget::OnNodeFocusOutEvent(Node* const node) noexcept {   assert(node);   m_popup->StartFadeOut();   //m_popup->setVisible(false); }  void GraphWidget::OnNodePositionChangedEvent(Node* const node) noexcept {   assert(node);   if (node->isSelected() || node->hasFocus())   {     m_popup->setPos(node->pos() + QPointF(25.0,-25.0));   } }  void GraphWidget::OnPopUpClicked(PopUp* const popup) noexcept {   const auto node = popup->GetNode();   if (node)   {     node->SetRay(node->GetRay() * 2.0);     //node->setScale(popup->GetNode()->scale() * 2.0);   } }  void GraphWidget::scaleView(qreal scaleFactor) noexcept {   const double factor{     transform().scale(scaleFactor, scaleFactor)       .mapRect(QRectF(0.0, 0.0, 1.0, 1.0)).width()   };   if (factor < 0.07 || factor > 100.0) return;    scale(scaleFactor, scaleFactor); }  void GraphWidget::shuffle() noexcept {   foreach (QGraphicsItem * const item, scene()->items())   {     if (qgraphicsitem_cast<Node *>(item))     {       item->setPos(         static_cast<double>(-150 + (qrand() % 300)),         static_cast<double>(-150 + (qrand() % 300))       );     }   } }  void GraphWidget::timerEvent(QTimerEvent *) noexcept {   QList<Node *> nodes;   foreach (QGraphicsItem *item, scene()->items())   {     if (Node * const node = qgraphicsitem_cast<Node *>(item))     {       nodes << node;     }   }   foreach (Node * const node, nodes)   {     node->calculateForces();   }    bool itemsMoved = false;   foreach (Node * const node, nodes)   {     if (node->advance()) itemsMoved = true;   }    if (!itemsMoved)   {     killTimer(m_timer_id);     m_timer_id = 0;   } }  void GraphWidget::wheelEvent(QWheelEvent *event) noexcept {   scaleView(std::pow(2.0, -event->delta() / 240.0)); }  void GraphWidget::zoomIn() noexcept {   scaleView(1.2); }  void GraphWidget::zoomOut() noexcept {   scaleView(1.0/1.2); }`
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/main.cpp
-----------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #include <QApplication>  #include "graphwidget.h"  int main(int argc, char **argv) {   QApplication app(argc, argv);   GraphWidget * const widget{new GraphWidget};   widget->show();   return app.exec(); }`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/node.h
---------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html #ifndef NODE_H #define NODE_H  #include <QGraphicsItem> #include <QList> #include <boost/signals2.hpp>  class Edge; class GraphWidget; class QGraphicsSceneMouseEvent;  class Node : public QGraphicsItem { public:   enum { Type = UserType + 1 };    Node(GraphWidget *graphWidget);   Node(const Node&) = delete;   Node& operator=(const Node&) = delete;    void addEdge(Edge *edge) noexcept;   bool advance() noexcept;   QRectF boundingRect() const noexcept override;   void calculateForces() noexcept;   QList<Edge *> edges() const noexcept;   double GetRay() const noexcept { return m_ray; }   void paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *widget) noexcept override;   void SetRay(const double ray);   void setShowBoundingRect(const bool show_bounding_rect) noexcept;   QPainterPath shape() const noexcept override;   int type() const noexcept override { return Type; }    boost::signals2::signal<void(Node * const)> m_signal_focus_in;   boost::signals2::signal<void(Node * const)> m_signal_focus_out;   boost::signals2::signal<void(Node * const)> m_signal_position_changed;   //signals:   //void signal_focus_changed(Node * const);  protected:    void focusInEvent(QFocusEvent *event) noexcept override;   void focusOutEvent(QFocusEvent *event) noexcept override;   QVariant itemChange(GraphicsItemChange change, const QVariant &value) noexcept override;   void mousePressEvent(QGraphicsSceneMouseEvent *event) noexcept override;   void mouseReleaseEvent(QGraphicsSceneMouseEvent *event) noexcept override;    private:   QList<Edge*> m_edges;   GraphWidget * const m_graph;   QPointF m_new_pos;   double m_ray; //The ray of the circle   bool m_show_bounding_rect; };  #endif`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/node.cpp
-----------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #include <QGraphicsScene> #include <QGraphicsSceneMouseEvent> #include <QPainter> #include <QStyleOption>  #include "edge.h" #include "node.h" #include "graphwidget.h"  Node::Node(GraphWidget *graphWidget)   :     m_signal_focus_in{},     m_signal_focus_out{},     m_signal_position_changed{},     m_edges{},     m_graph(graphWidget),     m_new_pos{},     m_ray{10.0},     m_show_bounding_rect{false} {   setFlag(ItemIsMovable);   setFlag(ItemIsFocusable);   setFlag(ItemIsSelectable);   setFlag(ItemSendsGeometryChanges);   setCacheMode(DeviceCoordinateCache);   setZValue(-1); }  void Node::addEdge(Edge *edge) noexcept {   m_edges << edge;   edge->adjust(); }  bool Node::advance() noexcept {   if (m_new_pos == pos()) return false;    setPos(m_new_pos);   return true; }  QRectF Node::boundingRect() const noexcept {   const double adjust{2.0};   return QRectF(     -m_ray - adjust,     -m_ray - adjust,      (2.0 * m_ray) + 3.0 + adjust,      (2.0 * m_ray) + 3.0 + adjust    ); }  void Node::calculateForces() noexcept {   if (!scene() || scene()->mouseGrabberItem() == this)   {     m_new_pos = pos();     return;   }    // Sum up all forces pushing this item away   double xvel = 0.0;   double yvel = 0.0;   foreach (QGraphicsItem *item, scene()->items())   {     Node * const node = qgraphicsitem_cast<Node *>(item);      if (!node) continue;      const QPointF vec{mapToItem(node, 0.0, 0.0)};     const double dx{vec.x()};     const double dy{vec.y()};     const double l{2.0 * (dx * dx + dy * dy)};     if (l > 0.0)     {       xvel += (dx * 150.0) / l;       yvel += (dy * 150.0) / l;     }   }    // Now subtract all forces pulling items together   const double weight = static_cast<double>(m_edges.size() + 1) * 10.0;   foreach (Edge *edge, m_edges)   {     const QPointF vec       = edge->sourceNode() == this       ? mapToItem(edge->destNode(), 0, 0)       : mapToItem(edge->sourceNode(), 0, 0)     ;     xvel -= vec.x() / weight;     yvel -= vec.y() / weight;   }    if (qAbs(xvel) < 0.1 && qAbs(yvel) < 0.1)   {     xvel = yvel = 0.0;   }    const QRectF sceneRect = scene()->sceneRect();   m_new_pos = pos() + QPointF(xvel, yvel);   m_new_pos.setX(qMin(qMax(m_new_pos.x(), sceneRect.left() + 10), sceneRect.right() - 10));   m_new_pos.setY(qMin(qMax(m_new_pos.y(), sceneRect.top() + 10), sceneRect.bottom() - 10)); }  QList<Edge *> Node::edges() const noexcept {   return m_edges; }  void Node::focusInEvent(QFocusEvent *) noexcept {   m_signal_focus_in(this); }  void Node::focusOutEvent(QFocusEvent *) noexcept {   m_signal_focus_out(this); }  QVariant Node::itemChange(GraphicsItemChange change, const QVariant &value) noexcept {   switch (change) {     case ItemPositionHasChanged:     {       foreach (Edge *edge, m_edges)       edge->adjust();       m_graph->itemMoved();       m_signal_position_changed(this);     }     break;     default:     break;   }    return QGraphicsItem::itemChange(change, value); }  void Node::mousePressEvent(QGraphicsSceneMouseEvent *event) noexcept {   update();   QGraphicsItem::mousePressEvent(event); }  void Node::mouseReleaseEvent(QGraphicsSceneMouseEvent *event) noexcept {   update();   QGraphicsItem::mouseReleaseEvent(event); }  void Node::paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *) noexcept {   //Draw the shadow   painter->setPen(Qt::NoPen);   painter->setBrush(Qt::darkGray);   painter->drawEllipse(-m_ray + 3.0,-m_ray + 3.0, 2.0 * m_ray, 2.0 * m_ray);    QRadialGradient gradient(-3, -3, 10);    const bool is_selected{option->state & QStyle::State_Sunken     || this->isSelected() };   if (is_selected)   {     gradient.setCenter(3, 3);     gradient.setFocalPoint(3, 3);     gradient.setColorAt(1, QColor(Qt::lightGray).light(120));     gradient.setColorAt(0, QColor(Qt::darkGray).light(120));   }   else   {     gradient.setColorAt(0, Qt::lightGray);     gradient.setColorAt(1, Qt::darkGray);   }   painter->setBrush(gradient);    painter->setPen(     QPen(       Qt::black,       1.0, //pen width       is_selected ? Qt::DashLine : Qt::SolidLine     )   );   painter->drawEllipse(-m_ray, -m_ray, 2.0 * m_ray, 2.0 * m_ray);    //Draw the bounding rectangle   if (m_show_bounding_rect)   {     painter->setBrush(QBrush(QColor(255,0,0,32)));     painter->setPen(QPen(QColor(255,0,0,64)));     painter->drawRect(this->boundingRect());   } }  void Node::SetRay(const double ray) {   m_ray = ray;   this->update(); }  QPainterPath Node::shape() const noexcept {   QPainterPath path;   path.addEllipse(-m_ray, -m_ray, 2.0*m_ray, 2.0*m_ray);   return path; }`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/popup.h
----------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef POPUP_H #define POPUP_H  #include <boost/signals2.hpp> #include <QGraphicsRectItem>  struct Node; struct QTimer;  class PopUp : public QGraphicsRectItem { public:   PopUp();   PopUp(const PopUp&) = delete;   PopUp& operator=(const PopUp&) = delete;   boost::signals2::signal<void(PopUp * const)> m_signal_clicked;   void SetNode(Node * const node);   Node * GetNode() const noexcept { return m_node; }   void StartFadeIn();   void StartFadeOut(); protected:   void mousePressEvent(QGraphicsSceneMouseEvent *event) noexcept; private:   enum class FadeMode { in, out } m_fademode;   Node * m_node; //The Node the PopUp belongs to   int m_transparancy; //Alpha value, 255: opaque };  #endif // POPUP_H`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample6/popup.cpp
------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "popup.h"  #include <cassert> #include <QMessageBox> #include <QTimer>  PopUp::PopUp()   :     m_signal_clicked{},     m_fademode{FadeMode::in},     m_node{nullptr},     m_transparancy{128} {   setZValue(10); }  void PopUp::mousePressEvent(QGraphicsSceneMouseEvent *) noexcept {   m_signal_clicked(this); }  void PopUp::SetNode(Node * const node) {   assert(node);   m_node = node; }  void PopUp::StartFadeIn() {   setVisible(true); }  void PopUp::StartFadeOut() {  }`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

[Go back to Richel Bilderbeek's C++ page](Cpp.htm).



 

[![Valid XHTML 1.0 Strict](valid-xhtml10.png){width="88"
height="31"}](http://validator.w3.org/check?uri=referer)

This page has been created by the [tool](Tools.htm)
[CodeToHtml](ToolCodeToHtml.htm)
