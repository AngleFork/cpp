



 

 

 

 

 

([C++](Cpp.htm)) [BrownianMotion](CppBrownianMotion.htm)
========================================================

 

![STL](PicStl.png)

 

[BrownianMotion](CppBrownianMotion.htm) contains some classes that are
related to the Brownian motion process.

Technical facts
---------------

 

 

 

 

 

 

./CppBrownianMotion/CppBrownianMotion.pri
-----------------------------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` INCLUDEPATH += \     ../../Classes/CppBrownianMotion  SOURCES += \     ../../Classes/CppBrownianMotion/brownianmotion.cpp \     ../../Classes/CppBrownianMotion/brownianmotionprocess.cpp \     ../../Classes/CppBrownianMotion/brownianmotionparameters.cpp \     ../../Classes/CppBrownianMotion/brownianmotionhelper.cpp  HEADERS  += \     ../../Classes/CppBrownianMotion/brownianmotion.h \     ../../Classes/CppBrownianMotion/brownianmotionprocess.h \     ../../Classes/CppBrownianMotion/brownianmotionparameters.h \     ../../Classes/CppBrownianMotion/brownianmotionhelper.h  OTHER_FILES += \     ../../Classes/CppBrownianMotion/Licence.txt`
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBrownianMotion/brownianmotion.h
------------------------------------

 

  -----------------------------------------------------------------------------------
  ` #ifndef BROWNIANMOTION_H #define BROWNIANMOTION_H   #endif // BROWNIANMOTION_H`
  -----------------------------------------------------------------------------------

 

 

 

 

 

./CppBrownianMotion/brownianmotion.cpp
--------------------------------------

 

  --------------------------------
  ` #include "brownianmotion.h"`
  --------------------------------

 

 

 

 

 

./CppBrownianMotion/brownianmotionhelper.h
------------------------------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef BROWNIANMOTIONHELPER_H #define BROWNIANMOTIONHELPER_H  #include "rate.h" #include <vector>  namespace ribi { namespace bm {  ///Performs a Brownian motion struct Helper {   using Volatility = ribi::units::Rate;   using VolatilitySquared = decltype(Volatility() * Volatility());    Helper();    ///Calculate the likelihood of the candidate parameters in generating the dataset   double CalcLogLikelihood(     const std::vector<double>& v,     const VolatilitySquared cand_volatility_squared   ) const;    ///Calculate the parameters that have a maximum likelihood in generating the values v   void CalcMaxLikelihood(     const std::vector<double>& v,     Volatility& volatility_hat   ) const;    double CalcMaxLogLikelihood(const std::vector<double>& v) const;    #ifndef NDEBUG   static void Test() noexcept;   #endif };  } //~namespace bm } //~namespace ribi  #endif // BROWNIANMOTIONHELPER_H`
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBrownianMotion/brownianmotionhelper.cpp
--------------------------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "brownianmotionhelper.h"  #include <cassert> #include <iostream> #include <stdexcept> #include <sstream>  #include <boost/math/constants/constants.hpp>  #include "testtimer.h"  ribi::bm::Helper::Helper() {   #ifndef NDEBUG   Test();   #endif }  double ribi::bm::Helper::CalcLogLikelihood(   const std::vector<double>& v,   const VolatilitySquared cand_volatility_squared   //const double cand_volatility ) const {   assert(!v.empty());    using boost::math::constants::two_pi;    if (cand_volatility_squared == 0.0 / boost::units::si::second / boost::units::si::second) return 0.0; //TODO: allow this   const double n{static_cast<double>(v.size())};   const double log_likelihood{     -((n/2.0)*std::log(cand_volatility_squared.value() * two_pi<double>()))     - std::inner_product(         std::begin(v)+1,         std::end(v),         std::begin(v),         0.0,         std::plus<double>(),         [cand_volatility_squared](const double a, const double b)         {           return std::pow(a - b,2.0) / (2.0 * cand_volatility_squared.value());         }       )   };   return log_likelihood; }  void ribi::bm::Helper::CalcMaxLikelihood(   const std::vector<double>& v,   Volatility& volatility_hat ) const {   const bool verbose{false};   const double n{static_cast<double>(v.size())};   const double sum{     std::inner_product(       std::begin(v)+1,       std::end(v),       std::begin(v),       0.0,       std::plus<double>(),       [](const double a, const double b)       {         return std::pow(a - b,2.0);       }     )   };    const double volatility_hat_squared{sum / n};    if (verbose)   {     std::cout       << "sum: " << sum << '\n'       << "n: " << n << '\n'       << "volatility_hat_squared: " << volatility_hat_squared << '\n'     ;   }   volatility_hat = std::sqrt(volatility_hat_squared) / boost::units::si::second; }  double ribi::bm::Helper::CalcMaxLogLikelihood(   const std::vector<double>& v ) const {   Volatility volatility_hat = 0.0 / boost::units::si::second;   CalcMaxLikelihood(v,volatility_hat);   return CalcLogLikelihood(v,volatility_hat * volatility_hat); }  #ifndef NDEBUG void ribi::bm::Helper::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   const TestTimer test_timer(__func__,__FILE__,1.0); } #endif`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBrownianMotion/brownianmotionparameters.h
----------------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef BROWNIANMOTIONPARAMETERS_H #define BROWNIANMOTIONPARAMETERS_H  #include "rate.h"  namespace ribi { namespace bm {  ///Performs a Brownian motion  struct Parameters {   using Volatility = ribi::units::Rate;    ///volatility: the standard deviation of the noise   Parameters(     const Volatility volatility,     const int rng_seed = 42   );    int GetRngSeed() const noexcept { return m_rng_seed; }   auto GetVolatility() const noexcept { return m_volatility; }    private:   const int m_rng_seed;   const Volatility m_volatility; };  } //~namespace bm } //~namespace ribi  #endif // BROWNIANMOTIONPARAMETERS_H`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBrownianMotion/brownianmotionparameters.cpp
------------------------------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "brownianmotionparameters.h"  #include <sstream> #include <stdexcept>   ribi::bm::Parameters::Parameters(   const Volatility volatility,   const int rng_seed ) : m_rng_seed{rng_seed},     m_volatility{volatility} {   //TODO: allow zero, then the process falls back to an autoregression   if (m_volatility <= 0.0 / boost::units::si::second)   {     std::stringstream s;     s << __func__       << ": volatility must be positive and non-zero, "       << "value given is " << m_volatility     ;     throw std::logic_error(s.str());   }  }`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBrownianMotion/brownianmotionprocess.h
-------------------------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef BROWNIANMOTIONPROCESS_H #define BROWNIANMOTIONPROCESS_H  #include "brownianmotionparameters.h" #include <random>  namespace ribi { namespace bm {  ///Performs a Brownian motion struct Process {   ///volatility: the standard deviation of the noise   Process(     const Parameters& parameters   );    ///Calculate the next x. This class will supply the random numbers,   ///thus these member functions are not const   double CalcNext(     const double x   );    ///Calculate the next x+dt, supplying the random numbers yourself   double CalcNext(     const double x,     const double random_normal   ) const;    #ifndef NDEBUG   static void Test() noexcept;   #endif    private:   std::normal_distribution<double> m_normal_distribution;   const Parameters m_parameters;   std::mt19937 m_rng; };  } //~namespace bm } //~namespace ribi  #endif // BROWNIANMOTIONPROCESS_H`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBrownianMotion/brownianmotionprocess.cpp
---------------------------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "brownianmotionprocess.h"  #include <cassert> #include <cmath> #include <iostream> #include <stdexcept> #include <sstream>  #include "brownianmotionhelper.h" #include <boost/math/constants/constants.hpp>  #include "testtimer.h"  ribi::bm::Process::Process(   const Parameters& parameters )   : m_normal_distribution(0.0,1.0),     m_parameters{parameters},     m_rng(parameters.GetRngSeed()) {   #ifndef NDEBUG   Test();   #endif }  double ribi::bm::Process::CalcNext(const double x) {   const double random_normal{m_normal_distribution(m_rng)};   return CalcNext(x,random_normal); }  double ribi::bm::Process::CalcNext(   const double x,   const double random_normal ) const {   const auto dt = 1.0 * boost::units::si::second;   const auto volatility = m_parameters.GetVolatility();   const auto dx = random_normal * volatility;   return x + (dt * dx); }  #ifndef NDEBUG void ribi::bm::Process::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   {     Helper();   }   const TestTimer test_timer(__func__,__FILE__,1.0);    const bool verbose{false};    //Create a Brownian motion with volatility   {     const auto volatility = 1.0 / boost::units::si::second;     bm::Process b(volatility);     double x{0.0};     std::vector<double> v = {x};     for (int i=0; i!=100; ++i)     {       x = b.CalcNext(x);       v.push_back(x);     }     //Are the likelihoods best at the true volatility?     const auto good_likelihood        = Helper().CalcLogLikelihood(v,volatility * volatility);     const auto bad_likelihood       = Helper().CalcLogLikelihood(v,volatility * volatility * 0.5);     const auto worse_likelihood       = Helper().CalcLogLikelihood(v,volatility * volatility * 1.5);     assert(good_likelihood > worse_likelihood);     assert(good_likelihood > bad_likelihood);     //Is the max likelihood truly the max likelihood?     auto volatility_hat = 0.0 / boost::units::si::second;     Helper().CalcMaxLikelihood(v,volatility_hat);     const auto max_likelihood       = Helper().CalcLogLikelihood(v,volatility_hat * volatility_hat);     assert(max_likelihood >= good_likelihood);   }     //Run a Brownian motion process   {     const std::vector<double> noises       = {        -1.0268,        -0.4985,         0.3825,        -0.8102,        -0.1206,        -1.9604,         0.2079,         0.9134,         2.1375,         0.5461,         1.4335,         0.4414,        -2.2912,         0.3249,        -1.3019,        -0.8995,         0.0281,        -1.0959,        -0.8118,        -1.3890       };     const std::vector<double> xs_expected      = {           0.0,         -10.268,         -15.253,         -11.428,         -19.53,         -20.736,         -40.34,         -38.261,         -29.127,         -7.752,         -2.291,         12.044,         16.458,         -6.454,         -3.205,         -16.224,         -25.219,         -24.938,         -35.897,         -44.015,         -57.905       };     const auto volatility = 10.0 / boost::units::si::second;     const double init_x{0.0};      const ribi::bm::Parameters parameters(volatility);     ribi::bm::Process sim(parameters);      double x = init_x;     std::vector<double> xs = {x};      for (const double noise: noises)     {       x = sim.CalcNext(x,noise);       xs.push_back(x);     }     assert(xs.size() == xs_expected.size());     const int sz{static_cast<int>(xs.size())};     for (int i=0; i!=sz; ++i)     {       assert(std::abs(xs[i]-xs_expected[i]) < 0.000000001);     }   }     //Worked example   {     const auto volatility = 0.5 / boost::units::si::second;     const double init_x{0.0};     const int seed{83};     std::normal_distribution<double> normal_distribution;     std::mt19937 rng(seed);      const ribi::bm::Parameters parameters(       volatility,       seed     );     ribi::bm::Process sim(parameters);      double x = init_x;     std::vector<double> xs = {x};      std::vector<double> random_normals(10);     std::generate(begin(random_normals),end(random_normals),       [&normal_distribution,&rng]() { return normal_distribution(rng); }     );     if (!"Show randoms")     {       std::copy(begin(random_normals),end(random_normals),         std::ostream_iterator<double>(std::cout,"\n")       );     }       for (int i=0; i!=10; ++i)     {       const double random_normal{random_normals[i]};       if (verbose) { std::cout << i << ": " << x << '\n'; }       x = sim.CalcNext(x,random_normal);       xs.push_back(x);     }     if (verbose) { std::cout << "10: " << x << '\n'; }      //CalcMaxLikelihood: find best parameters     auto cand_volatility = 0.0 / boost::units::si::second;     Helper().CalcMaxLikelihood(xs,cand_volatility);     const auto expected_cand_volatility       = 0.38056299195796983  / boost::units::si::second;     assert(std::abs(cand_volatility.value() - expected_cand_volatility.value()) < 0.0001);      //CalcLogLikelihood: use parameters     const double max_log_likelihood{       Helper().CalcLogLikelihood(xs,cand_volatility * cand_volatility)     };     if (verbose)     {       std::cout << std::setprecision(20)         << "cand_volatility: " << cand_volatility << '\n'         << "max_log_likelihood: " << max_log_likelihood << '\n'       ;     }     const double expected_max_log_likelihood{-4.9811786934375552605};     assert(std::abs(max_log_likelihood - expected_max_log_likelihood) < 0.0001);     assert(!std::isnan(cand_volatility.value()));      //CalcMaxLogLikelihood: find best parameters and use them in one step     const double max_log_likelihood_too{       Helper().CalcMaxLogLikelihood(xs)     };     assert(std::abs(max_log_likelihood_too - expected_max_log_likelihood) < 0.0001);   }  } #endif`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 





 




This page has been created by the [tool](Tools.htm)
[CodeToHtml](ToolCodeToHtml.htm)
