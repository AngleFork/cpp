
 

 

 

 

 

([C++](Cpp.md)) [KalmanFilterExample5](CppKalmanFilterExample5.md)
====================================================================

 

[Kalman filter example 5](CppKalmanFilterExample5.md) is an example to
use a [Kalman filter](CppKalmanFilter.md).

 

-   [Download the Qt Creator project
    'CppKalmanFilterExample5' (zip)](CppKalmanFilterExample5.zip)

 

 

 

 

 

 

 

 

 

 

Technical facts
---------------

 

[Application type(s)](CppApplication.md)

-   ![Desktop](PicDesktop.png) [Desktop
    application](CppDesktopApplication.md)

[Operating system(s) or programming environment(s)](CppOs.md)

-   ![Lubuntu](PicLubuntu.png) [Lubuntu](CppLubuntu.md) 12.10 (quantal)

[IDE(s)](CppIde.md):

-   ![Qt Creator](PicQtCreator.png) [Qt Creator](CppQtCreator.md) 2.5.2

[Project type](CppQtProjectType.md):

-   ![console](PicConsole.png) [Console
    application](CppConsoleApplication.md)

[C++ standard](CppStandard.md):

-   ![C++11](PicCpp11.png) [C++11](Cpp11.md)

[Compiler(s)](CppCompiler.md):

-   [G++](CppGpp.md) 4.7.2

[Libraries](CppLibrary.md) used:

-   ![STL](PicStl.png) [STL](CppStl.md): GNU ISO C++ Library, version
    4.7.2

 

 

 

 

 

[Qt project file](CppQtProjectFile.md): CppKalmanFilterExample5.pro
--------------------------------------------------------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` TEMPLATE = app  CONFIG += console  CONFIG -= qt  QMAKE_CXXFLAGS += -Wall -Wextra -Werror -std=c++11    SOURCES += main.cpp \      kalmanfilter.cpp \      whitenoisesystem.cpp \      matrix.cpp    HEADERS += \      kalmanfilter.h \      whitenoisesystem.h \      matrix.h `
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

kalmanfilter.h
--------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef KALMANFILTER_H #define KALMANFILTER_H  #include <boost/numeric/ublas/matrix.hpp> #include <boost/numeric/ublas/vector.hpp>  struct KalmanFilter {   ///Initialize the filter with a first measurent   KalmanFilter(     const boost::numeric::ublas::matrix<double>& control,     const boost::numeric::ublas::vector<double>& first_x,     const boost::numeric::ublas::matrix<double>& first_p,     const boost::numeric::ublas::matrix<double>& measurement_noise,     const boost::numeric::ublas::matrix<double>& observation,     const boost::numeric::ublas::matrix<double>& process_noise_covariance,     const boost::numeric::ublas::matrix<double>& state_transition     );    ///Give the filter a measurement (but no input), and it will update its predictions.   void SupplyMeasurement(const boost::numeric::ublas::vector<double>& x);    ///Give the filter a measurement and input, and it will update its predictions   void SupplyMeasurementAndInput(     const boost::numeric::ublas::vector<double>& x,     const boost::numeric::ublas::vector<double>& input);    ///Let the filter predict   const boost::numeric::ublas::vector<double>& Predict() const { return m_x; }    ///Let the filter predict   const boost::numeric::ublas::matrix<double>& PredictCovariance() const { return m_p; }    private:   //B: control matrix: the effect of inputs on the current states   const boost::numeric::ublas::matrix<double> m_control;    //R: Estimated measurement noise: How to estimate this?   const boost::numeric::ublas::matrix<double> m_measurement_noise;    //H   const boost::numeric::ublas::matrix<double> m_observation;    ///The (current prediction of the) covariance   boost::numeric::ublas::matrix<double> m_p;    //Q: Process noise covariance: How to estimate this?   const boost::numeric::ublas::matrix<double> m_process_noise_covariance;    //F: state transition matrix   const boost::numeric::ublas::matrix<double> m_state_transition;    ///The (current prediction of the) measurement   boost::numeric::ublas::vector<double> m_x;  };  #endif // KALMANFILTER_H`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

kalmanfilter.cpp
----------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifdef _WIN32 #undef __STRICT_ANSI__ #endif  #include "kalmanfilter.h" #include "matrix.h"  KalmanFilter::KalmanFilter(   const boost::numeric::ublas::matrix<double>& control,   const boost::numeric::ublas::vector<double>& first_x,   const boost::numeric::ublas::matrix<double>& first_p,   const boost::numeric::ublas::matrix<double>& measurement_noise,   const boost::numeric::ublas::matrix<double>& observation,   const boost::numeric::ublas::matrix<double>& process_noise_covariance,   const boost::numeric::ublas::matrix<double>& state_transition)   : m_control(control),     m_measurement_noise(measurement_noise),     m_observation(observation),     m_p(first_p),     m_process_noise_covariance(process_noise_covariance),     m_state_transition(state_transition),     m_x(first_x) {   #ifndef NDEBUG   //Check for correct dimensionality   const auto sz = m_x.size();   assert(m_control.size1() == sz);   assert(m_control.size2() == sz);   assert(m_measurement_noise.size1() == sz);   assert(m_measurement_noise.size2() == sz);   assert(m_observation.size1() == sz);   assert(m_observation.size2() == sz);   assert(m_p.size1() == sz);   assert(m_p.size2() == sz);   assert(m_process_noise_covariance.size1() == sz);   assert(m_process_noise_covariance.size2() == sz);   assert(m_state_transition.size1() == sz);   assert(m_state_transition.size2() == sz);   assert(m_x.size() == sz);   #endif }  void KalmanFilter::SupplyMeasurement(   const boost::numeric::ublas::vector<double>& x) {   const boost::numeric::ublas::vector<double> input     = boost::numeric::ublas::vector<double>(x.size(),0.0);   return SupplyMeasurementAndInput(x,input); }  void KalmanFilter::SupplyMeasurementAndInput(   const boost::numeric::ublas::vector<double>& x,   const boost::numeric::ublas::vector<double>& input) {   using boost::numeric::ublas::identity_matrix;   using boost::numeric::ublas::matrix;   using boost::numeric::ublas::prod;   using boost::numeric::ublas::trans;   using boost::numeric::ublas::vector;   ///Debug statements to keep code below clean   /// 2/7) Covariance prediction   assert(m_state_transition.size2() == m_p.size1());   assert( prod(m_state_transition,m_p).size2()     ==  trans(m_state_transition).size1() );   assert(matrix<double>(prod(       matrix<double>(prod(m_state_transition,m_p)),       trans(m_state_transition))).size1()     == m_process_noise_covariance.size1());   assert(matrix<double>(prod(       matrix<double>(prod(m_state_transition,m_p)),       trans(m_state_transition))).size2()     == m_process_noise_covariance.size2());    /// 1/7) State prediction   const vector<double> x_current     = prod(m_state_transition,m_x)     + prod(m_control,input);   /// 2/7) Covariance prediction   const matrix<double> p_current     = matrix<double>(       prod(         matrix<double>(prod(m_state_transition,m_p)),         trans(m_state_transition)       )     )     + m_process_noise_covariance;   /// 3/7) Innovation (y with a squiggle above it)   const vector<double> z_measured = x; //x has noise itn it   const vector<double> innovation = z_measured - prod(m_observation,x_current);   /// 4/7) Innovation covariance (S)   const matrix<double> innovation_covariance     = matrix<double>(prod(           matrix<double>(prod(m_observation,p_current)),           trans(m_observation)         ))     + m_measurement_noise;   /// 5/7) Kalman gain (K)   const matrix<double> kalman_gain     = prod(         matrix<double>(         prod(           p_current,           trans(m_observation)         )),         Matrix::Inverse(innovation_covariance)       );   /// 6/7) Update state prediction   m_x = x_current + prod(kalman_gain,innovation);   /// 7/7) Update covariance prediction   const identity_matrix<double> my_identity_matrix(kalman_gain.size1());   m_p = prod(     my_identity_matrix       - matrix<double>(prod(kalman_gain,m_observation)),     p_current   ); }`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

main.cpp
--------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifdef _WIN32 #undef __STRICT_ANSI__ #endif  ///Kalman filter example ///Adapted from merge from www.adrianboeing.com and http://greg.czerniak.info/guides/kalman1 ///following /// * Simon, Dan. Kalman Filtering. Embedded Systems Programming. June 2001.  #include <iostream> #include <vector> #include <boost/shared_ptr.hpp> #include <boost/numeric/ublas/io.hpp> #include <boost/numeric/ublas/matrix.hpp> #include "kalmanfilter.h" #include "matrix.h" #include "whitenoisesystem.h"  ///Context: ///A car that has a constant acceleration that has its position determined by GPS ///The car its speedometer is not used (as observation(1,1) is equal to 0.0), ///  and gives junk values (as x_real_noise(1) is equal to 10000000.0) int main() {   Matrix::Test();    using boost::numeric::ublas::matrix;   using boost::numeric::ublas::vector;    const double t = 0.1;   const double acceleration = 1.0;    //The real state vector   //[ position ]   //[ velocity ]   const vector<double> x_real = Matrix::CreateVector( { 0.0, 0.0 } );    //Real measurement noise   //[ standard deviation of noise in position ]   [ standard deviation of noise in GPS                       ]   //[ standard deviation of noise in velocity ] = [ standard deviation of noise in defect/unused speedometer ]   const vector<double> x_real_measurement_noise = Matrix::CreateVector( { 10.0, 10000000.0 } );    //Guess of the state matrix   //Position and velocity guess is way off on purpose   //[ position ]   //[ velocity ]   const vector<double> x_first_guess = Matrix::CreateVector( { 100.0, 10.0 } );    //Guess of the covariances   //[ 1.0   0.0 ]   //[ 0.0   1.0 ]   const matrix<double> p_first_guess = Matrix::CreateMatrix(2,2, { 1.0, 0.0, 0.0, 1.0 } );    //Effect of inputs on state   //Input = gas pedal, which gives acceleration 'a'   //[ 1.0   0.5 * t * t ]   [teleportation (not used)                 x = 0.5 * a * t * t ]   //[ 0.0   t           ] = [no effect of teleportation on velocity   v = a * t           ]   const matrix<double> control = Matrix::CreateMatrix(2,2, { 1.0, 0.0, 0.5 * t * t, t } );    //Estimated measurement noise   //[ 10.0          0.0 ]   [ Estimated noise in GPS   ?                                                     ]   //[  0.0   10000000.0 ] = [ ?                        Estimated noise in speedometer (absent in this setup) ]   const matrix<double> measurement_noise = Matrix::CreateMatrix(2,2, { 10.0, 0.0, 0.0, 10000000.0 } );    //Observational matrix   //[ 1.0   0.0 ]   [GPS measurement   ?                                         ]   //[ 0.0   0.0 ] = [?                 Speedometer (absent/unused in this setup) ]   const matrix<double> observation = Matrix::CreateMatrix(2,2, { 1.0, 0.0, 0.0, 0.0 } );    //Real process noise   //[ 0.001 ]   [ noise in position ]   //[ 0.001 ] = [ noise in velocity ]   const vector<double> real_process_noise = Matrix::CreateVector( {0.01,0.01} );    //Estimated process noise covariance   //[ 0.01   0.01 ]   //[ 0.01   0.01 ]   const matrix<double> process_noise = Matrix::CreateMatrix(2,2,{0.01,0.01,0.01,0.01});    //State transition matrix, the effect of the current state on the next   //[ 1.0     t ]   [ position keeps its value             a velocity changes the position ]   //[ 0.0   1.0 ] = [ position has no effect on velocity   a velocity keeps its value      ]   const matrix<double> state_transition = Matrix::CreateMatrix(2,2,{1.0,0.0,t,1.0});    WhiteNoiseSystem s(control,x_real,x_real_measurement_noise,real_process_noise,state_transition);    KalmanFilter k(control,x_first_guess,p_first_guess,measurement_noise,observation,process_noise,state_transition);    std::cout << "x_real,x_measured,x_Kalman,v_real,v_measured,v_Kalman\n";   for (int i=0;i!=250;++i)   {     //A constant push the gas pedal, which results in a constant acceleration     const vector<double> input = Matrix::CreateVector( { 0.0, acceleration } );     //Update reality, that is, let the real system (i.e. reality) go to its next state     s.GoToNextState(input);     //Perform a noisy measurement     const vector<double> z_measured = s.Measure();     //Pass this measurement to the filter     k.SupplyMeasurementAndInput(z_measured,input);     //Display what the filter predicts     const vector<double> x_est_last = k.Predict();      std::cout << s.PeekAtRealState()(0) << "," << z_measured(0) << "," << x_est_last(0) << "," << s.PeekAtRealState()(1) << "," << z_measured(1) << "," << x_est_last(1) << '\n';   } }`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

matrix.h
--------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef MATRIX_H  #define MATRIX_H    #include <boost/numeric/ublas/matrix.hpp>  #include <boost/numeric/ublas/vector.hpp>    ///Helper class for matrix operations  struct Matrix  {    ///Create a n_rows x n_cols sized matrix from a std::vector,    ///used for easy initialization    static const boost::numeric::ublas::matrix<double> CreateMatrix(      const std::size_t n_rows,      const std::size_t n_cols,      const std::vector<double>& v);        ///Create a uBLAS vector from a std::vector,    ///used for easy initialization    static const boost::numeric::ublas::vector<double> CreateVector(const std::vector<double>& v);      ///Calculate the inverse of a matrix    static const boost::numeric::ublas::matrix<double> Inverse(      const boost::numeric::ublas::matrix<double>& m);      ///Test these functions    static void Test();    };    #endif // MATRIX_H `
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

matrix.cpp
----------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifdef _WIN32  #undef __STRICT_ANSI__  #endif    #include "matrix.h"    #include <iostream>  #include <boost/numeric/ublas/io.hpp>    const boost::numeric::ublas::matrix<double> Matrix::CreateMatrix(    const std::size_t n_rows,    const std::size_t n_cols,    const std::vector<double>& v)  {    assert(n_rows * n_cols == v.size());    boost::numeric::ublas::matrix<double> m(n_rows,n_cols);    for (std::size_t row = 0; row!=n_rows; ++row)    {      for (std::size_t col = 0; col!=n_cols; ++col)      {        m(row,col) = v[ (col * n_rows) + row];      }    }    return m;  }    const boost::numeric::ublas::vector<double> Matrix::CreateVector(const std::vector<double>& v)  {    boost::numeric::ublas::vector<double> w(v.size());    std::copy(v.begin(),v.end(),w.begin());    return w;  }    const boost::numeric::ublas::matrix<double> Matrix::Inverse(    const boost::numeric::ublas::matrix<double>& m)  {    assert(m.size1() == m.size2() && "Can only calculate the inverse of square matrices");    switch(m.size1())    {      case 1:      {        assert(m.size1() == 1 && m.size2() == 1 && "Only for 1x1 matrices");        assert(m(0,0) != 0.0 && "Cannot take the inverse of matrix [0]");        boost::numeric::ublas::matrix<double> n(1,1);        n(0,0) =  1.0 / m(0,0);        return n;      }      case 2:      {        assert(m.size1() == 2 && m.size2() == 2 && "Only for 2x2 matrices");        const double a = m(0,0);        const double b = m(0,1);        const double c = m(1,0);        const double d = m(1,1);        const double determinant = (a * d) - (b * c);        boost::numeric::ublas::matrix<double> n(2,2);        n(0,0) =  d / determinant;        n(0,1) = -b / determinant;        n(1,0) = -c / determinant;        n(1,1) =  a / determinant;        return n;      }      default:        assert(!"Should not get here: unsupported matrix size");        throw std::runtime_error("Unsupported matrix size");    }  }    void Matrix::Test()  {    {      static bool is_tested = false;      if (is_tested) return;      is_tested = true;    }    using boost::numeric::ublas::matrix;    using boost::numeric::ublas::vector;    {      ///[1,4]      ///[2,5]      ///[3,6]      const matrix<int> m = CreateMatrix(3,2, {1,2,3,4,5,6} );      assert(m(0,0) == 1);      assert(m(1,0) == 2);      assert(m(2,0) == 3);      assert(m(0,1) == 4);      assert(m(1,1) == 5);      assert(m(2,1) == 6);    }    {      /// [ 1.0 2.0 ] -1    [ -2.0   1.0 ]      /// [ 3.0 4.0 ]     = [  1.5  -0.5 ]      const matrix<double> m = CreateMatrix(2,2, {1.0,3.0,2.0,4.0} );      assert(m(0,0) == 1.0);      assert(m(1,0) == 3.0);      assert(m(0,1) == 2.0);      assert(m(1,1) == 4.0);      const matrix<double> n = Inverse(m);      const double epsilon = 0.0000001; //Rounding error      assert(n(0,0) > -2.0 - epsilon && n(0,0) < -2.0 + epsilon);      assert(n(1,0) >  1.5 - epsilon && n(1,0) <  1.5 + epsilon);      assert(n(0,1) >  1.0 - epsilon && n(0,1) <  1.0 + epsilon);      assert(n(1,1) > -0.5 - epsilon && n(1,1) < -0.5 + epsilon);    }  } `
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

whitenoisesystem.h
------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef WHITENOISESYSTEM_H #define WHITENOISESYSTEM_H  #include <boost/numeric/ublas/matrix.hpp>  struct WhiteNoiseSystem {   WhiteNoiseSystem(     const boost::numeric::ublas::matrix<double>& control,     const boost::numeric::ublas::vector<double>& initial_state,     const boost::numeric::ublas::vector<double>& real_measurement_noise,     const boost::numeric::ublas::vector<double>& real_process_noise,     const boost::numeric::ublas::matrix<double>& state_transition);    ///Update reality, that is, let the real system (i.e. reality) go to its next state,   ///without any input   void GoToNextState();    ///Update reality, that is, let the real system (i.e. reality) go to its next state   void GoToNextState(const boost::numeric::ublas::vector<double>& input);    ///Measure a value from this system with normally distributed noise   const boost::numeric::ublas::vector<double> Measure() const;    ///Peek what the real value is   const boost::numeric::ublas::vector<double>& PeekAtRealState() const { return m_current_state; }    private:   ///The control matrix to determine the influence of the input (in GoToNextState)   const boost::numeric::ublas::matrix<double> m_control;    ///The real value of the system   boost::numeric::ublas::vector<double> m_current_state;    ///The standard deviation of the noise in the state transition (in GoToNextState)   const boost::numeric::ublas::vector<double> m_process_noise;    ///The amount of noise in the system   ///A noise of zero indicates a system that can be measured accurately to infinite precision   const boost::numeric::ublas::vector<double> m_real_measurement_noise;    ///The state transitions in the system, used in GoToNextState   const boost::numeric::ublas::matrix<double> m_state_transition;    ///Obtain a random number from a normal distribution   ///From http://www.richelbilderbeek.nl/CppGetRandomNormal.htm   static double GetRandomNormal(const double mean = 0.0, const double sigma = 1.0);  };  #endif // WHITENOISESYSTEM_H`
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

whitenoisesystem.cpp
--------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifdef _WIN32 #undef __STRICT_ANSI__ #endif  #include "whitenoisesystem.h"  #include <iostream> #include <boost/numeric/ublas/io.hpp> #include <boost/random/lagged_fibonacci.hpp> #include <boost/random/normal_distribution.hpp>  WhiteNoiseSystem::WhiteNoiseSystem(   const boost::numeric::ublas::matrix<double>& control,   const boost::numeric::ublas::vector<double>& initial_state,   const boost::numeric::ublas::vector<double>& real_measurement_noise,   const boost::numeric::ublas::vector<double>& real_process_noise,   const boost::numeric::ublas::matrix<double>& state_transition)   : m_control(control),     m_current_state(initial_state),     m_process_noise(real_process_noise),     m_real_measurement_noise(real_measurement_noise),     m_state_transition(state_transition) {   #ifndef NDEBUG   //Check for correct dimensionality   const auto sz = initial_state.size();   assert(m_control.size1() == sz);   assert(m_control.size2() == sz);   assert(m_current_state.size() == sz);   assert(m_process_noise.size() == sz);   assert(m_real_measurement_noise.size() == sz);   assert(m_state_transition.size1() == sz);   assert(m_state_transition.size2() == sz);   #endif }  double WhiteNoiseSystem::GetRandomNormal(const double mean, const double sigma) {   boost::normal_distribution<double> norm_dist(mean, sigma);   static boost::lagged_fibonacci19937 engine;   const double value = norm_dist.operator () <boost::lagged_fibonacci19937>((engine));   return value; }  void WhiteNoiseSystem::GoToNextState() {   //Create a no-input vector   const auto sz = m_current_state.size();   boost::numeric::ublas::vector<double> input(sz,0.0);   return GoToNextState(input); }  void WhiteNoiseSystem::GoToNextState(const boost::numeric::ublas::vector<double>& input) {   //First do a perfect transition   m_current_state     = boost::numeric::ublas::prod(m_state_transition,m_current_state)     + boost::numeric::ublas::prod(m_control,input);   //Add process noise   const auto sz = m_current_state.size();   assert(m_current_state.size() == m_process_noise.size());   for (std::size_t i = 0; i!=sz; ++i)   {     m_current_state(i) = GetRandomNormal(m_current_state(i),m_process_noise(i));   } }  const boost::numeric::ublas::vector<double> WhiteNoiseSystem::Measure() const {   const auto sz = m_current_state.size();   assert(m_current_state.size() == m_real_measurement_noise.size());   boost::numeric::ublas::vector<double> measured(sz);   for (std::size_t i = 0; i!=sz; ++i)   {     measured(i) = GetRandomNormal(m_current_state(i),m_real_measurement_noise(i));   }   return measured; }`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

 

This page has been created by the [tool](Tools.md)
[CodeToHtml](ToolCodeToHtml.md)
