
 

 

 

 

 

([C++](Cpp.md)) [NewickUtils](CppNewickUtils.md)
==================================================

 

Technical facts
---------------

 

 

 

 

 

 

./CppNewickUtils/CppNewickUtils.pri
-----------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` INCLUDEPATH += \     ../../Classes/CppNewickUtils  SOURCES += \     ../../Classes/CppNewickUtils/newickutils.cpp \     ../../Classes/CppNewickUtils/newickutils_test.cpp  HEADERS  += \     ../../Classes/CppNewickUtils/newickutils.h  OTHER_FILES += \     ../../Classes/CppNewickUtils/Licence.txt`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppNewickUtils/newickutils.h
------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef RIBI_NEWICKUTILS_H #define RIBI_NEWICKUTILS_H  #include <string> #include <vector>  namespace ribi {  ///Wrapper to call newick_utils struct NewickUtils {   enum class GraphicsFormat { svg };    NewickUtils();     ///Display Newick to console, use GetPhylogeny to obtain the text   void Display(const std::string& newick);    ///Drops the extinct lineages, throws if R script fails   std::string DropExtinct(const std::string& newick) const;    ///GetPhylogeny returns the Newick as a phylogeny in text   std::vector<std::string> GetPhylogeny(const std::string& newick);    std::string GetVersion() const noexcept;   std::vector<std::string> GetVersionHistory() const noexcept;    ///Plot Newick as a phylogeny in a graphics format,   ///folloing the same interface as PhylogenyR   void NewickToPhylogeny(     std::string newick,     const std::string& filename,     const GraphicsFormat graphics_format,     const bool plot_fossils = true   ) const;    private:   static const std::string sm_newick_utils_path;    #ifndef NDEBUG   static void Test() noexcept;   #endif };  } //~namespace ribi  #endif //RIBI_NEWICKUTILS_H`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppNewickUtils/newickutils.cpp
--------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "newickutils.h"  #include <cassert> #include <fstream> #include <iostream> #include <sstream> #include <stdexcept>  #include "fileio.h" #include "trace.h" #include "phylogeny_r.h"  const std::string ribi::NewickUtils::sm_newick_utils_path{"../../Libraries/newick_utils/src"};  ribi::NewickUtils::NewickUtils() {   #ifndef NDEBUG   Test();   #endif   const std::string executable{sm_newick_utils_path + "/nw_display"};   if (!ribi::fileio::FileIo().IsRegularFile(executable))   {     std::stringstream s;     s       << "Error: nw_display executable '" << executable << "' not found\n"       << "Please change the path\n"     ;     throw std::logic_error(s.str().c_str());   }  }  void ribi::NewickUtils::Display(const std::string& newick) {   const std::string executable{sm_newick_utils_path + "/nw_display"};   assert(ribi::fileio::FileIo().IsRegularFile(executable) && "Checked in constructor");   const std::string cmd{"echo \""+ newick + "\" | " + executable +" -"};   const int error = std::system(cmd.c_str());   if (error)   {     std::clog << __func__ << ": error " << error << '\n';   } }  std::string ribi::NewickUtils::DropExtinct(const std::string& newick) const {   return PhylogenyR().DropExtinct(newick); }  std::vector<std::string> ribi::NewickUtils::GetPhylogeny(const std::string& newick) {   const std::string executable{sm_newick_utils_path + "/nw_display"};   assert(ribi::fileio::FileIo().IsRegularFile(executable) && "Checked in constructor");   const std::string tmp_filename{     ribi::fileio::FileIo().GetTempFileName(".txt")   };   assert(!ribi::fileio::FileIo().IsRegularFile(tmp_filename));   const std::string cmd{"echo \""+ newick + "\" | " + executable +" - > " + tmp_filename};   const int error = std::system(cmd.c_str());   if (error)   {     std::clog << __func__ << ": error " << error << '\n';   }    //Result   const std::vector<std::string> v{     ribi::fileio::FileIo().FileToVector(tmp_filename)   };    //Clean up   ribi::fileio::FileIo().DeleteFile(tmp_filename);    return v; }  std::string ribi::NewickUtils::GetVersion() const noexcept {   return "1.0"; }  std::vector<std::string> ribi::NewickUtils::GetVersionHistory() const noexcept {   return {     "2015-06-13: Version 1.0: started versioning"   }; }  void ribi::NewickUtils::NewickToPhylogeny(   std::string newick,   const std::string& filename,   const GraphicsFormat graphics_format,   const bool plot_fossils ) const {   assert(graphics_format == GraphicsFormat::svg);   if (graphics_format != GraphicsFormat::svg)   {     throw std::logic_error("NewickUtils::NewickToPhylogeny: not yet implemented this GraphicsFormat");   }   if (plot_fossils == false)   {     newick = DropExtinct(newick);   }   const std::string executable{sm_newick_utils_path + "/nw_display"};   assert(ribi::fileio::FileIo().IsRegularFile(executable) && "Checked in constructor");   const std::string cmd{"echo \""+ newick + "\" | " + executable +" - -s > " + filename};   const int error = std::system(cmd.c_str());   if (error)   {     std::clog << __func__ << ": error " << error << '\n';   }   assert(ribi::fileio::FileIo().IsRegularFile(filename)); }`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppNewickUtils/newickutils\_test.cpp
--------------------------------------

 

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "newickutils.h"  #include <cassert>  #include "fileio.h" #include "phylogeny_r.h" #include "testtimer.h" #include "trace.h"  #ifndef NDEBUG void ribi::NewickUtils::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   {     PhylogenyR();   }   const ribi::TestTimer test_timer(__func__,__FILE__,1.0);   const bool verbose{false};   if (verbose) { TRACE("GetPhylogeny"); }   {     const std::string newick{"(1,2);"};     std::vector<std::string> v{NewickUtils().GetPhylogeny(newick)};     assert(!v.empty());   }   if (verbose) { TRACE("DropExtinct"); }   {     assert(       NewickUtils().DropExtinct(            "(L:1,(((((XD:1,ZD:1):1,CE:2):1,(FE:2,EE:2):1):1,(GD:1,ID:1):1,BD:1):3,(AC:1,EC:1):1,(((TC:1,FD:2):1,QC:1,RC:1):1,((((AE:1,BE:1):1,(WD:1,YD:1):1):1,HD:1):2,MC:1):1):1):3);"       ) == "((((XD:1,ZD:1):1,CE:2):1,(FE:2,EE:2):1):4,((AE:1,BE:1):1,(WD:1,YD:1):1):5);"     );   }   if (verbose) { TRACE("NewickToPhylogeny on easy phylogeny"); }   {     const std::string temp_svg_filename{       ribi::fileio::FileIo().GetTempFileName(".svg")     };     const bool plot_fossils{true};     const std::string newick{"((F:2,G:2):1,H:3);"};     NewickUtils().NewickToPhylogeny(       newick,       temp_svg_filename,       NewickUtils::GraphicsFormat::svg,       plot_fossils     );     assert(ribi::fileio::FileIo().IsRegularFile(temp_svg_filename));     //Clean up     ribi::fileio::FileIo().DeleteFile(temp_svg_filename.c_str());   }   if (verbose) { TRACE("NewickToPhylogeny on hard phylogeny"); }   //ISSUE_267 does affect PhylogenyR, but not this class   {     const std::string newick{       "(L:1,(((((XD:1,ZD:1):1,CE:2):1,(FE:2,EE:2):1):1,(GD:1,ID:1):1,BD:1):3,(AC:1,EC:1):1,(((TC:1,FD:2):1,QC:1,RC:1):1,((((AE:1,BE:1):1,(WD:1,YD:1):1):1,HD:1):2,MC:1):1):1):3);"     };     for (bool plot_fossils: {true,false})     {       const std::string temp_svg_filename{         ribi::fileio::FileIo().GetTempFileName(".svg")       };       NewickUtils().NewickToPhylogeny(newick,temp_svg_filename,         NewickUtils::GraphicsFormat::svg,         plot_fossils       );       assert(ribi::fileio::FileIo().IsRegularFile(temp_svg_filename));       ribi::fileio::FileIo().DeleteFile(temp_svg_filename.c_str());     }   }   #ifdef FIX_ISSUE_269   //NewickToPhylogeny as PNG   {     const std::string temp_png_filename{       ribi::fileio::FileIo().GetTempFileName(".png")     };     const bool plot_fossils{false};     const std::string newick{"((F:2,G:2):1,H:3);"};     NewickUtils().NewickToPhylogeny(       newick,       temp_png_filename,       NewickUtils::GraphicsFormat::png,       plot_fossils     );     assert(ribi::fileio::FileIo().IsRegularFile(temp_png_filename));     //Clean up     ribi::fileio::FileIo().DeleteFile(temp_png_filename.c_str());   }   #endif // FIX_ISSUE_269 } #endif`
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

 

