[Go back to Richel Bilderbeek's homepage](index.htm).

[Go back to Richel Bilderbeek's C++ page](Cpp.htm).

 

 

 

 

 

([C++](Cpp.htm)) [PaperRockScissorsWithTraitSimulation](CppPaperRockScissorsWithTraitSimulation.htm)
====================================================================================================

 

Technical facts
---------------

 

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/CppPaperRockScissorsWithTraitSimulation.pri
-------------------------------------------------------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` INCLUDEPATH += \     ../../Classes/CppPaperRockScissorsWithTraitSimulation  SOURCES += \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitsimulation.cpp \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitindividual.cpp \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitinitialization.cpp \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitparameters.cpp  HEADERS  += \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitsimulation.h \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitindividual.h \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitinitialization.h \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitparameters.h  OTHER_FILES += \     ../../Classes/CppPaperRockScissorsWithTraitSimulation/Licence.txt`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitindividual.h
--------------------------------------------------------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef PAPERROCKSCISSORSWITHTRAITINDIVIDUAL_H #define PAPERROCKSCISSORSWITHTRAITINDIVIDUAL_H  #include "paperrockscissors.h"  namespace ribi { namespace prswt { //Paper-Rock-Scissors-With-Trait  struct Individual {   Individual(     const PaperRockScissors prs,     const double trait   );   Individual(const Individual&);   Individual& operator=(const Individual&);    PaperRockScissors GetPrs() const noexcept { return m_prs; }   double GetTrait() const noexcept { return m_trait; }    private:   const PaperRockScissors m_prs;   const double m_trait;    #ifndef NDEBUG   static void Test() noexcept;   #endif };  bool DoesBeat(   const Individual& lhs,   const Individual& rhs );  bool operator==(   const Individual& lhs,   const Individual& rhs );  bool operator!=(   const Individual& lhs,   const Individual& rhs );  } //~namespace ribi } //~namespace prswt { //Paper-Rock-Scissors-With-Trait  #endif // PAPERROCKSCISSORSWITHTRAITINDIVIDUAL_H`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitindividual.cpp
----------------------------------------------------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "paperrockscissorswithtraitindividual.h"  #include <cassert>  ribi::prswt::Individual::Individual(     const PaperRockScissors prs,     const double trait   )   : m_prs(prs), m_trait(trait) {   #ifndef NDEBUG   Test();   #endif }  ribi::prswt::Individual::Individual(   const Individual& other)   : m_prs(other.m_prs),     m_trait(other.m_trait) {  }  ribi::prswt::Individual&   ribi::prswt::Individual::operator=(   const Individual& rhs ) {   using Prs = PaperRockScissors;    const_cast<Prs&>(this->m_prs) = rhs.m_prs;   const_cast<double&>(this->m_trait) = rhs.m_trait;   return *this; }  #ifndef NDEBUG void ribi::prswt::Individual::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   using Prs = PaperRockScissors;   {     const Individual a(Prs::paper,1.2);     const Individual b(Prs::paper,1.2);     assert(a == b);   }   {     const Individual a(Prs::paper,1.2);     const Individual b(Prs::rock,1.2);     assert(a != b);   }   {     const Individual a(Prs::paper,1.2);     const Individual b(Prs::paper,2.3);     assert(a != b);   }   {     const Individual a(Prs::paper,1.2);     Individual b(Prs::paper,2.3);     assert(a != b);     b = a;     assert(a == b);   }   {     const Individual a(Prs::paper,1.2);     const Individual b(a);     assert(a == b);   } } #endif  bool ribi::prswt::DoesBeat(   const Individual& lhs,   const Individual& rhs ) {   return DoesBeat(lhs.GetPrs(),rhs.GetPrs()); }  bool ribi::prswt::operator==(   const Individual& lhs,   const Individual& rhs ) {   return        lhs.GetPrs() == rhs.GetPrs()     && lhs.GetTrait() == rhs.GetTrait()   ; }  bool ribi::prswt::operator!=(   const Individual& lhs,   const Individual& rhs ) {   return !(lhs == rhs); }`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitinitialization.h
------------------------------------------------------------------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef PAPERROCKSCISSORSWITHTRAITINITIALIZATION_H #define PAPERROCKSCISSORSWITHTRAITINITIALIZATION_H  #include <iosfwd>  namespace ribi { namespace prswt { //Paper-Rock-Scissors-With-Trait  enum class Initialization {   random,   vertical_bands,   monomorph };  std::string ToStr(const Initialization initialization) noexcept; Initialization ToInitialization(const std::string& s);  std::ostream& operator<<(std::ostream& os, const Initialization initialization); std::istream& operator>>(std::istream& is, Initialization& initialization);  #ifndef NDEBUG void TestInitialization() noexcept; #endif  } //~namespace prswt { //Paper-Rock-Scissors-With-Trait } //~namespace ribi  #endif // PAPERROCKSCISSORSWITHTRAITINITIALIZATION_H`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitinitialization.cpp
--------------------------------------------------------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "paperrockscissorswithtraitinitialization.h"  #include <cassert> #include <fstream> #include <iostream> #include <stdexcept>  #include "fileio.h"  #ifndef NDEBUG void ribi::prswt::TestInitialization() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   const auto all = {     Initialization::random,     Initialization::vertical_bands,     Initialization::monomorph   };    //ToStr   {     for (const auto i: all)     {       const std::string s = ToStr(i);       const auto j = ToInitialization(s);       const std::string t = ToStr(j);       assert(i == j);       assert(s == t);     }   }   //File I/O   {     for (const auto i: all)     {       const std::string filename = ribi::fileio::FileIo().GetTempFileName(".txt");       //Write to file       {         std::ofstream f(filename);         f << i;       }       //Read from file       std::ifstream f(filename);       Initialization j{Initialization::random};       f >> j;       assert(i == j);       ribi::fileio::FileIo().DeleteFile(filename);     }   } } #endif  std::string ribi::prswt::ToStr(const Initialization initialization) noexcept {   switch (initialization)   {     case Initialization::random: return "random";     case Initialization::vertical_bands: return "vertical_bands";     case Initialization::monomorph: return "monomorph";     default: assert(!"Should not get here");   }   assert(!"Should not get here");   throw std::logic_error("ribi::prswt::ToStr: unknown value of initialization"); }  ribi::prswt::Initialization ribi::prswt::ToInitialization(const std::string& s) {   if (s == "random") return Initialization::random;   if (s == "vertical_bands") return Initialization::vertical_bands;   if (s == "monomorph") return Initialization::monomorph;   throw std::logic_error("ribi::prswt::ToInitialization: unknown s"); }   std::ostream& ribi::prswt::operator<<(std::ostream& os, const Initialization initialization) {   os << ToStr(initialization);   return os; }  std::istream& ribi::prswt::operator>>(std::istream& is, Initialization& initialization) {   std::string s;   is >> s;   initialization = ToInitialization(s);   return is; }`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitparameters.h
--------------------------------------------------------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef PAPERROCKSCISSORSWITHTRAITPARAMETERS_H #define PAPERROCKSCISSORSWITHTRAITPARAMETERS_H  #include "paperrockscissorswithtraitinitialization.h"  namespace ribi { namespace prswt { //Paper-Rock-Scissors-With-Trait  struct Parameters {   Parameters(     const int width,     const int height,     const Initialization initialization,     const int rng_seed   );   int GetHeight() const noexcept { return m_height; }   Initialization GetInitialization() const noexcept { return m_initialization; }   int GetRngSeed() const noexcept { return m_rng_seed; }   int GetWidth() const noexcept { return m_width; }    void SetHeight(const int height);   void SetInitialization(const Initialization initialization) noexcept;   void SetRngSeed(const int rng_seed) noexcept;   void SetWidth(const int width);    private:   int m_width;   int m_height;   Initialization m_initialization;   int m_rng_seed;    #ifndef NDEBUG   static void Test() noexcept;   #endif };  std::ostream& operator<<(std::ostream& os, const Parameters& parameters); std::istream& operator>>(std::istream& is, Parameters& parameters); bool operator==(const Parameters& lhs, const Parameters& rhs) noexcept; bool operator!=(const Parameters& lhs, const Parameters& rhs) noexcept;  } //~namespace prswt { //Paper-Rock-Scissors-With-Trait } //~namespace ribi  #endif // PAPERROCKSCISSORSWITHTRAITPARAMETERS_H`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitparameters.cpp
----------------------------------------------------------------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "paperrockscissorswithtraitparameters.h"  #include <cassert> #include <fstream> #include <iostream> #include <stdexcept> #include "fileio.h"  ribi::prswt::Parameters::Parameters(   const int width,   const int height,   const Initialization initialization,   const int rng_seed ) : m_width{width},     m_height{height},     m_initialization{initialization},     m_rng_seed{rng_seed} {   #ifndef NDEBUG   Test();   #endif }  void ribi::prswt::Parameters::SetHeight(const int height) {   if (height < 1) throw std::logic_error("ribi::prswt::Parameters::SetHeight: invalid height");   assert(height > 0);   m_height = height; }  void ribi::prswt::Parameters::SetInitialization(const Initialization initialization) noexcept {   m_initialization = initialization; }  void ribi::prswt::Parameters::SetRngSeed(const int rng_seed) noexcept {   m_rng_seed = rng_seed; }  void ribi::prswt::Parameters::SetWidth(const int width) {   if (width < 1) throw std::logic_error("ribi::prswt::Parameters::SetWidth: invalid width");   assert(width > 0);   m_width = width; }    #ifndef NDEBUG void ribi::prswt::Parameters::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   {     TestInitialization();   }   //operator==   {     const Parameters p(2,3,Initialization::monomorph,42);     const Parameters q(2,3,Initialization::monomorph,42);     assert(p == q);   }   //operator==   {     const Parameters p(2,3,Initialization::monomorph,42);     const Parameters q(p);     assert(p == q);   }   //operator!=, varied width   {     const Parameters p(2,3,Initialization::monomorph,42);     Parameters q(p);     q.SetWidth(q.GetWidth() + 1);     assert(p != q);   }   //operator!=, varied height   {     const Parameters p(2,3,Initialization::monomorph,42);     Parameters q(p);     q.SetHeight(q.GetHeight() + 1);     assert(p != q);   }   //operator!=, varied initialization   {     const Parameters p(2,3,Initialization::monomorph,42);     Parameters q(p);     q.SetInitialization(Initialization::vertical_bands);     assert(p != q);   }   //operator!=, varied RNG seed   {     const Parameters p(2,3,Initialization::monomorph,42);     Parameters q(p);     q.SetRngSeed(q.GetRngSeed() + 1);     assert(p != q);   }   //File Io   {     const Parameters p(2,3,Initialization::monomorph,42);     const std::string filename = ribi::fileio::FileIo().GetTempFileName(".txt");     //Write to file     {       std::ofstream f(filename);       f << p;     }     //Read from file     std::ifstream f(filename);     Parameters q(p);     f >> q;     assert(p == q);     ribi::fileio::FileIo().DeleteFile(filename);   }  } #endif  std::ostream& ribi::prswt::operator<<(std::ostream& os, const Parameters& parameters) {   os     << "width: " << parameters.GetWidth()     << " height: " << parameters.GetHeight()     << " initialization: " << parameters.GetInitialization()     << " rng_seed: " << parameters.GetRngSeed()   ;   return os; }  std::istream& ribi::prswt::operator>>(std::istream& is, Parameters& parameters) {   std::string s;   is >> s;   assert(s == "width:");   int width = -1;   is >> width;    is >> s;   assert(s == "height:");   int height = -1;   is >> height;    is >> s;   assert(s == "initialization:");   Initialization initialization = Initialization::random;   is >> initialization;    is >> s;   assert(s == "rng_seed:");   int rng_seed = 0;   is >> rng_seed;    parameters = Parameters(width,height,initialization,rng_seed);    return is; }  bool ribi::prswt::operator==(const Parameters& lhs, const Parameters& rhs) noexcept {   return        lhs.GetHeight() == rhs.GetHeight()     && lhs.GetInitialization() == rhs.GetInitialization()     && lhs.GetRngSeed() == rhs.GetRngSeed()     && lhs.GetWidth() == rhs.GetWidth()   ; }  bool ribi::prswt::operator!=(const Parameters& lhs, const Parameters& rhs) noexcept {   return !(lhs == rhs); }`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitsimulation.h
--------------------------------------------------------------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef PAPERROCKSCISSORSWITHTRAITSIMULATION_H #define PAPERROCKSCISSORSWITHTRAITSIMULATION_H  #include <random> #include <vector> #include "paperrockscissors.h" #include "paperrockscissorswithtraitindividual.h" #include "paperrockscissorswithtraitinitialization.h" #include "paperrockscissorswithtraitparameters.h"  namespace ribi { namespace prswt { //Paper-Rock-Scissors-With-Trait  struct Simulation {   Simulation(     const Parameters& parameters   );    ///Y-X ordered grid   const auto& GetGrid() const noexcept { return m_grid; }    const auto& GetParameters() const noexcept { return m_parameters; }    //Initialization GetInitialization() const noexcept { return m_initialization; }   std::tuple<int,int,int> GetLastPopSizes() const;   std::tuple<double,double,double> GetLastMeanTraits() const;    void Next();   void SetInitialization(const Initialization initialization) noexcept;    private:    std::vector<std::vector<Individual>> m_grid;   std::mt19937 m_rng;    std::uniform_int_distribution<int> m_uniform_distribution;   std::normal_distribution<double> m_normal_distribution;    std::vector<std::tuple<int,int,int>> m_popsizes;   std::vector<std::tuple<double,double,double>> m_mean_traits;    Parameters m_parameters;    #ifndef NDEBUG   static void Test() noexcept;   #endif };  } //namespace prswt { //Paper-Rock-Scissors-With-Trait } //~namespace ribi  #endif // PAPERROCKSCISSORSWITHTRAITSIMULATION_H`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppPaperRockScissorsWithTraitSimulation/paperrockscissorswithtraitsimulation.cpp
----------------------------------------------------------------------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "paperrockscissorswithtraitsimulation.h"  #include <array> #include <cassert> #include <algorithm> #include <cstdlib> #include <map> #include <tuple>  ribi::prswt::Simulation::Simulation(   const Parameters& parameters)   : m_grid{},     m_rng(parameters.GetRngSeed()),     m_uniform_distribution(0,3), //Inclusive     m_normal_distribution(0.0,1.0),     m_popsizes{},     m_mean_traits{},     m_parameters{parameters} {   #ifndef NDEBUG   Test();   #endif   SetInitialization(m_parameters.GetInitialization()); }  std::tuple<int,int,int> ribi::prswt::Simulation::GetLastPopSizes() const {   assert(!m_popsizes.empty());   return m_popsizes.back(); }  std::tuple<double,double,double> ribi::prswt::Simulation::GetLastMeanTraits() const {   assert(!m_mean_traits.empty());   return m_mean_traits.back(); }   void ribi::prswt::Simulation::Next() {   using Prs = PaperRockScissors;   std::map<Prs,double> sum_traits;   sum_traits[Prs::paper   ] = 0.0;   sum_traits[Prs::rock    ] = 0.0;   sum_traits[Prs::scissors] = 0.0;    std::map<Prs,int> tally_popsizes;   tally_popsizes[Prs::paper   ] = 0;   tally_popsizes[Prs::rock    ] = 0;   tally_popsizes[Prs::scissors] = 0;    std::vector<std::vector<Individual>> next(m_grid);   const int height{static_cast<int>(m_grid.size())};   const int width{static_cast<int>(m_grid[0].size())};   for (int y=0; y!=height; ++y)   {     for (int x=0; x!=width; ++x)     {       int dx{0};       int dy{0};        switch (m_uniform_distribution(m_rng))       {         case 0: --dy; break;         case 1: ++dx; break;         case 2: ++dy; break;         case 3: --dx; break;         default: assert(!"Should not get here");       }       auto& here = m_grid[y][x];       const auto& neighbour = m_grid[(y+dy+height)%height][(x+dx+width)%width];       const auto& winner = DoesBeat(neighbour,here) ? neighbour : here;       if (winner == neighbour)       {         const double new_trait{winner.GetTrait() + m_normal_distribution(m_rng)};         next[y][x]           = Individual(             winner.GetPrs(),             new_trait           )         ;         ++tally_popsizes[winner.GetPrs()];         sum_traits[winner.GetPrs()] += winner.GetTrait();       }       else       {         const double new_trait{here.GetTrait() + m_normal_distribution(m_rng)};         next[y][x]           = Individual(             here.GetPrs(),             new_trait           )         ;         sum_traits[here.GetPrs()] += here.GetTrait();         ++tally_popsizes[here.GetPrs()];       }     }   }    {     const int n_p{tally_popsizes[Prs::paper]};     const int n_r{tally_popsizes[Prs::rock]};     const int n_s{tally_popsizes[Prs::scissors]};     assert(n_p >= 0);     assert(n_r >= 0);     assert(n_s >= 0);     m_popsizes.push_back(std::make_tuple(n_p,n_r,n_s));   }   m_mean_traits.push_back(     std::make_tuple(       sum_traits[Prs::paper   ] / static_cast<double>(tally_popsizes[Prs::paper   ]),       sum_traits[Prs::rock    ] / static_cast<double>(tally_popsizes[Prs::rock    ]),       sum_traits[Prs::scissors] / static_cast<double>(tally_popsizes[Prs::scissors])     )    );   std::swap(m_grid,next); }  void ribi::prswt::Simulation::SetInitialization(const Initialization initialization) noexcept {   using Prs = PaperRockScissors;    m_popsizes.clear();   m_mean_traits.clear();   m_grid.clear();   std::map<Prs,int> tally;   tally[Prs::paper] = 0;   tally[Prs::rock] = 0;   tally[Prs::scissors] = 0;     m_parameters.SetInitialization(initialization);    //Initialize the grid   assert(m_grid.empty());   const int height = m_parameters.GetHeight();   const int width = m_parameters.GetWidth();   for (int y=0; y!=height; ++y)   {     assert(y == static_cast<int>(m_grid.size()));     m_grid.push_back(std::vector<Individual>());     assert(y < static_cast<int>(m_grid.size()));     for (int x=0; x!=width; ++x)     {       assert(x == static_cast<int>(m_grid[y].size()));        Prs prs = Prs::paper;       switch(initialization)       {         case Initialization::random:         {           static std::uniform_int_distribution<int> d(0,2); //Inclusive           switch (d(m_rng))           {             case 0: prs = Prs::paper; break;             case 1: prs = Prs::rock; break;             case 2: prs = Prs::scissors; break;             default: assert(!"Should not get here");           }         }         break;         case Initialization::vertical_bands:         {           switch ((y / (height / 15)) % 3)           {             case 0: prs = Prs::paper; break;             case 1: prs = Prs::rock; break;             case 2: prs = Prs::scissors; break;             default: assert(!"Should not get here");           }         }         break;         case Initialization::monomorph:           prs = Prs::paper;         break;         default: assert(!"Should not get here");       }       m_grid[y].push_back(Individual(prs,0.0));       ++tally[prs];     }   }    {     const int n_p{tally[Prs::paper]};     const int n_r{tally[Prs::rock]};     const int n_s{tally[Prs::scissors]};     assert(n_p >= 0);     assert(n_r >= 0);     assert(n_s >= 0);     m_popsizes.push_back(std::make_tuple(n_p,n_r,n_s));   }   m_mean_traits.push_back(     std::make_tuple(0.0,0.0,0.0)   ); }  #ifndef NDEBUG void ribi::prswt::Simulation::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   TestInitialization(); } #endif`
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

[Go back to Richel Bilderbeek's C++ page](Cpp.htm).

[Go back to Richel Bilderbeek's homepage](index.htm).

 

[![Valid XHTML 1.0 Strict](valid-xhtml10.png){width="88"
height="31"}](http://validator.w3.org/check?uri=referer)

This page has been created by the [tool](Tools.htm)
[CodeToHtml](ToolCodeToHtml.htm)
