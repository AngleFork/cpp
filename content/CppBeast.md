



 

 

 

 

 

([C++](Cpp.htm)) [Beast](CppBeast.htm)
======================================

 

![STL](PicStl.png)

 

[Beast](CppBeast.htm) contain the resources to work with the tool
[BEAST2](ToolBeast2.htm).

Technical facts
---------------

 

 

 

 

 

 

./CppBeast/CppBeast.pri
-----------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` INCLUDEPATH += \     ../../Classes/CppBeast  SOURCES += \     ../../Classes/CppBeast/beast.cpp \     ../../Classes/CppBeast/beastparameterfile.cpp \     ../../Classes/CppBeast/beaststatefile.cpp \     ../../Classes/CppBeast/beast_test.cpp \     ../../Classes/CppBeast/beastparameterfile_test.cpp \     ../../Classes/CppBeast/beaststatefile_test.cpp  HEADERS  += \     ../../Classes/CppBeast/beast.h \     ../../Classes/CppBeast/beaststatefile.h \     ../../Classes/CppBeast/beastparameterfile.h  OTHER_FILES += \     ../../Classes/CppBeast/Licence.txt  RESOURCES += \     ../../Classes/CppBeast/CppBeast.qrc`
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beast.h
------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef RIBI_BEAST_H #define RIBI_BEAST_H  #include <string> #include <vector>  namespace ribi {  ///Class to call BEAST2 struct Beast {   //Throws if BEAST2 cannot be found   Beast();     void AnalyzeBirthDeath(     const std::string& log_file,     const std::string png_filename   ) const;    void AnalyzeCoalescent(     const std::string& log_file,     const std::string png_filename_coalescent_constant,     const std::string png_filename_popsize   ) const;    std::string GetVersion() const noexcept;   std::vector<std::string> GetVersionHistory() const noexcept;    void Run(     const std::string& xml_input_filename,     const std::string& log_output_filename,     const std::string& trees_output_filename   ) const noexcept;    private:   static const std::string sm_beast_path;    void AnalyzeBirthDeathRinside(     const std::string& log_file,     const std::string png_filename   ) const;    void AnalyzeBirthDeathRscript(     const std::string& log_file,     const std::string png_filename   ) const;    void AnalyzeCoalescentRinside(     const std::string& log_file,     const std::string png_filename_coalescent_constant,     const std::string png_filename_popsize   ) const;    void AnalyzeCoalescentRscript(     const std::string& log_file,     const std::string png_filename_coalescent_constant,     const std::string png_filename_popsize   ) const;     #ifndef NDEBUG   static void Test() noexcept;   #endif };  } //~namespace ribi  #endif //RIBI_BEAST_H`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beast.cpp
--------------------

 

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "beast.h"  #include <cassert> #include <fstream> #include <iostream> #include <sstream> #include <stdexcept>  #include "RInside.h"  #include "fileio.h" #include "ribi_rinside.h"  const std::string ribi::Beast::sm_beast_path{"../../../../Programs/BEAST/bin"};  ribi::Beast::Beast() {   #ifndef NDEBUG   Test();   #endif   const std::string executable{sm_beast_path + "/beast"};   if (!ribi::fileio::FileIo().IsRegularFile(executable))   {     std::stringstream s;     s       << "Error: BEAST executable '" << executable << "' not found\n"       << "Please change the path\n"     ;     throw std::logic_error(s.str().c_str());   } }  void ribi::Beast::AnalyzeBirthDeath(   const std::string& log_file,   const std::string png_filename ) const {   AnalyzeBirthDeathRinside(log_file,png_filename); }  void ribi::Beast::AnalyzeBirthDeathRinside(   const std::string& log_file,   const std::string png_filename ) const {   auto& r = ribi::Rinside().Get();   ribi::fileio::FileIo f;   assert(f.IsRegularFile(log_file));    r.parseEval("library(ape)");   r.parseEval("library(geiger)");   r.parseEval("library(phangorn)");   r["log_file"] = log_file;   r["png_filename"] = png_filename;   r.parseEval("data_raw <- read.table(log_file,header = TRUE)");   r.parseEval("data <- tail(data_raw,n = nrow(data_raw) * 0.9)");   r.parseEval("png(filename=png_filename)");   r.parseEval("hist(data$BirthDeath)");   r.parseEval("dev.off()");    if (!f.IsRegularFile(png_filename))   {     std::stringstream s;     s << __FILE__ << "(" << __LINE__ << "): "       << "Could not create PNG file "       << "with filename '" << png_filename << "'. "       << "Perhaps not all packages (ape,geiger,phangorn) needed are installed? "     ;     throw std::runtime_error(s.str().c_str());   }  }   void ribi::Beast::AnalyzeBirthDeathRscript(   const std::string& log_file,   const std::string png_filename ) const {   using ribi::fileio::FileIo;   assert(FileIo().IsRegularFile(log_file));    //TODO: Test if the user has all required packages    const std::string temp_r_filename{     FileIo().GetTempFileName(".R")   };    //Create the R script   {     std::ofstream f(temp_r_filename.c_str());     f       << "library(ape)" << '\n'       << "library(geiger)" << '\n'       << "library(phangorn)" << '\n'       << "data_raw <- read.table(\"" << log_file << "\",header = TRUE)" << '\n'       << "data <- tail(data_raw,n = nrow(data_raw) * 0.9)" << '\n'       << "png(filename=\"" << png_filename << "\")" << '\n'       << "hist(data$BirthDeath)" << '\n'       << "dev.off()" << '\n'     ;   }    if (!FileIo().IsRegularFile(temp_r_filename))   {     std::stringstream s;     s << __FILE__ << "(" << __LINE__ << "): "       << "Could not create temporary R script file "       << "with filename '" << temp_r_filename << "'";     throw std::runtime_error(s.str().c_str());   }    //Execute the R script   {     std::stringstream cmd;     cmd << "Rscript " << temp_r_filename;     const int error{std::system(cmd.str().c_str())};     if (error)     {       std::clog << __FILE__ << ": error " << error << '\n';     }   }    if (!FileIo().IsRegularFile(png_filename))   {     std::stringstream s;     s << __FILE__ << "(" << __LINE__ << "): "       << "Could not create SVG file "       << "with filename '" << png_filename << "'. "       << "Perhaps not all packages (ape) needed are installed? "       << "You can try to run the temporary R script file '"       << temp_r_filename       << "' yourself to see which error it gives"     ;     throw std::runtime_error(s.str().c_str());   }   //After detection. so user can check script   FileIo().DeleteFile(temp_r_filename); }  void ribi::Beast::AnalyzeCoalescent(   const std::string& log_file,   const std::string png_filename_coalescent_constant,   const std::string png_filename_popsize ) const {   AnalyzeCoalescentRinside(     log_file,     png_filename_coalescent_constant,     png_filename_popsize   ); }  void ribi::Beast::AnalyzeCoalescentRinside(   const std::string& log_file,   const std::string png_filename_coalescent_constant,   const std::string png_filename_popsize ) const {   ribi::fileio::FileIo f;   auto& r = ribi::Rinside().Get();    r.parseEval("library(ape)");   r.parseEval("library(geiger)");   r.parseEval("library(phangorn)");   r["log_file"] = log_file;   r["png_filename_popsize"] = png_filename_popsize;   r["png_filename_coalescent_constant"] = png_filename_coalescent_constant;    r.parseEval("data_raw <- read.table(log_file,header = TRUE)");   r.parseEval("data <- tail(data_raw,n = nrow(data_raw) * 0.9)");   r.parseEval("png(filename=png_filename_popsize)");   r.parseEval("hist(data$popSize)");   r.parseEval("dev.off()");   r.parseEval("png(filename=png_filename_coalescent_constant)");   r.parseEval("hist(data$CoalescentConstant)");   r.parseEval("dev.off()");     if (!f.IsRegularFile(png_filename_coalescent_constant))   {     std::stringstream s;     s << __FILE__ << "(" << __LINE__ << "): "       << "Could not create file "       << "with filename '" << png_filename_coalescent_constant << "'. "     ;     throw std::runtime_error(s.str().c_str());   }   if (!f.IsRegularFile(png_filename_popsize))   {     std::stringstream s;     s << __FILE__ << "(" << __LINE__ << "): "       << "Could not create file "       << "with filename '" << png_filename_popsize << "'. "     ;     throw std::runtime_error(s.str().c_str());   }   }  void ribi::Beast::AnalyzeCoalescentRscript(   const std::string& log_file,   const std::string png_filename_coalescent_constant,   const std::string png_filename_popsize ) const {   using ribi::fileio::FileIo;    //TODO: Test if the user has all required packages    const std::string temp_r_filename{     FileIo().GetTempFileName(".R")   };    //Create the R script   {     std::ofstream f(temp_r_filename.c_str());     f       << "library(ape)" << '\n'       << "library(geiger)" << '\n'       << "library(phangorn)" << '\n'       << "data_raw <- read.table(\"" << log_file << "\",header = TRUE)" << '\n'       << "data <- tail(data_raw,n = nrow(data_raw) * 0.9)" << '\n'       << "png(filename=\"" << png_filename_popsize << "\")" << '\n'       << "hist(data$popSize)" << '\n'       << "dev.off()" << '\n'       << "png(filename=\"" << png_filename_coalescent_constant << "\")" << '\n'       << "hist(data$CoalescentConstant)" << '\n'       << "dev.off()" << '\n'     ;   }    if (!FileIo().IsRegularFile(temp_r_filename))   {     std::stringstream s;     s << __FILE__ << "(" << __LINE__ << "): "       << "Could not create temporary R script file "       << "with filename '" << temp_r_filename << "'";     throw std::runtime_error(s.str().c_str());   }    //Execute the R script   {     std::stringstream cmd;     cmd << "Rscript " << temp_r_filename;     const int error{std::system(cmd.str().c_str())};     if (error)     {       std::clog << __FILE__ << ": error " << error << '\n';     }   }    if (!FileIo().IsRegularFile(png_filename_coalescent_constant))   {     std::stringstream s;     s << __FILE__ << "(" << __LINE__ << "): "       << "Could not create SVG file "       << "with filename '" << png_filename_coalescent_constant << "'. "       << "You can try to run the temporary R script file '"       << temp_r_filename       << "' yourself to see which error it gives"     ;     throw std::runtime_error(s.str().c_str());   }   if (!FileIo().IsRegularFile(png_filename_popsize))   {     std::stringstream s;     s << __FILE__ << "(" << __LINE__ << "): "       << "Could not create SVG file "       << "with filename '" << png_filename_popsize << "'. "       << "You can try to run the temporary R script file '"       << temp_r_filename       << "' yourself to see which error it gives"     ;     throw std::runtime_error(s.str().c_str());   }   //After detection. so user can check script   FileIo().DeleteFile(temp_r_filename); }  std::string ribi::Beast::GetVersion() const noexcept {   return "1.0"; }  std::vector<std::string> ribi::Beast::GetVersionHistory() const noexcept {   return {     "2015-06-13: Version 1.0: started versioning"   }; }  void ribi::Beast::Run(   const std::string& xml_input_filename,   const std::string& log_output_filename,   const std::string& trees_output_filename ) const noexcept {   const ribi::fileio::FileIo fileio;   const std::string executable{sm_beast_path + "/beast"};   assert(ribi::fileio::FileIo().IsRegularFile(executable)     && "Checked in constructor");    const std::string cmd{executable + " -overwrite " + xml_input_filename};   const int error{std::system(cmd.c_str())};   if (error)   {     std::clog << __FILE__ << ": error " << error << '\n';   }    assert(fileio.IsRegularFile(xml_input_filename));     if (fileio.IsRegularFile("alignment.log"))   {     fileio.CopyFile("alignment.log",log_output_filename);     fileio.DeleteFile("alignment.log");   }   if (fileio.IsRegularFile("alignment.trees"))   {     fileio.CopyFile("alignment.trees",trees_output_filename);     fileio.DeleteFile("alignment.trees");   } }`
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beast\_test.cpp
--------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "beast.h"  #include <cassert> #include <chrono>  #include <QFile>  #include "RInside.h"  #include "fileio.h" #include "testtimer.h" #include "ribi_rinside.h" #include "trace.h"  #ifndef NDEBUG void ribi::Beast::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   {     ribi::fileio::FileIo();     ribi::Rinside();     auto& r = ribi::Rinside().Get();     r.parseEval("library(ape)");     r.parseEval("library(geiger)");     r.parseEval("library(phangorn)");   }   const ribi::TestTimer test_timer(__func__,__FILE__,1.0);   const bool verbose{false};   if (verbose) { TRACE("Constructor"); }   {     Beast();   }   Beast b;   ribi::fileio::FileIo f;    const std::string log_file_bd{"CppBeastLogFileBirthDeath.log"};   const std::string log_file_coa{"CppBeastLogFileCoalescent.log"};   const std::vector<std::string> resource_filenames     =     {       log_file_bd, log_file_coa     };   //Create resources   for (const auto& s: resource_filenames)   {     if (!f.IsRegularFile(s))     {       QFile((std::string(":/CppBeast/") + s).c_str()).copy(s.c_str());     }     assert(f.IsRegularFile(s));   }    if (!"Speed comparison AnalyzeBirthDeath")   {     const std::string png_filename{f.GetTempFileName(".png")};      const auto t2 = std::chrono::system_clock::now();     b.AnalyzeBirthDeathRinside(       log_file_bd,       png_filename     );     const auto d2 = std::chrono::system_clock::now() - t2;      const auto t1 = std::chrono::system_clock::now();     b.AnalyzeBirthDeathRscript(       log_file_bd,       png_filename     );      const auto d1 = std::chrono::system_clock::now() - t1;     assert(d2 < d1 / 10);   }    if (!"Speed comparison AnalyzeCoalescent")   {     const std::string png_filename1{f.GetTempFileName(".png")};     const std::string png_filename2{f.GetTempFileName(".png")};      const auto t2 = std::chrono::system_clock::now();     b.AnalyzeCoalescentRinside(       log_file_coa,       png_filename1,       png_filename2     );     const auto d2 = std::chrono::system_clock::now() - t2;      const auto t1 = std::chrono::system_clock::now();     b.AnalyzeCoalescentRscript(       log_file_coa,       png_filename1,       png_filename2     );      const auto d1 = std::chrono::system_clock::now() - t1;     assert(d2 < d1 / 10);   }    //Cleanup resources   for (const auto& s: resource_filenames)   {     assert(f.IsRegularFile(s));     f.DeleteFile(s);     assert(!f.IsRegularFile(s));   } } #endif`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beastparameterfile.h
-------------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef BEASTPARAMETERFILE_H #define BEASTPARAMETERFILE_H  #include <string> #include <vector>  namespace ribi { struct DnaSequence; }  ///Creates a BEAST XML parameter file struct BeastParameterFile {   enum class TreePrior { birth_death, coalescent_constant_population };    /// alignment_base_filename: if the alignment was made   ///   from e.g. 'MyData.fas', alignment_base_filename must be 'MyData'   BeastParameterFile(     const std::vector<ribi::DnaSequence>& sequences,     const std::string& alignment_base_filename,     const int mcmc_chainlength,     const TreePrior tree_prior   );    const std::vector<ribi::DnaSequence>& GetSequences() const noexcept { return m_sequences; }   int GetMcmcChainlengths() const noexcept { return m_mcmc_chainlength; }   TreePrior GetTreePrior() const noexcept { return m_tree_prior; }    ///Convert an alignment   std::vector<std::string> ToBirthDeathXml() const noexcept;    private:   const std::string m_alignment_base_filename;   const int m_mcmc_chainlength;   const std::vector<ribi::DnaSequence> m_sequences;   const TreePrior m_tree_prior;    #ifndef NDEBUG   static void Test() noexcept;   #endif };  std::ostream& operator<<(std::ostream& os, const BeastParameterFile file);  #endif // BEASTPARAMETERFILE_H`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beastparameterfile.cpp
---------------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "beastparameterfile.h"  #include <cassert> #include <sstream>  #include "container.h" #include "dnasequence.h" //#include "fileio.h"  BeastParameterFile::BeastParameterFile(   const std::vector<ribi::DnaSequence>& sequences,   const std::string& alignment_base_filename,   const int mcmc_chainlength,   const TreePrior tree_prior ) :     m_alignment_base_filename{alignment_base_filename},     m_mcmc_chainlength{mcmc_chainlength},     m_sequences{sequences},     m_tree_prior{tree_prior} {   #ifndef NDEBUG   Test();   #endif }  std::vector<std::string> BeastParameterFile::ToBirthDeathXml() const noexcept {   // Birth death model   std::vector<std::string> v;   v.push_back("<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><beast beautitemplate='Standard' beautistatus='' namespace=\"beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood\" version=\"2.0\">");   v.push_back("");   v.push_back("");   const std::string filename_base{m_alignment_base_filename}; //Probably the alignment filename   // I use the same (non-)indentation as BEAUti   v.push_back("    <data");   v.push_back("id=\"" + filename_base + "\"");   v.push_back("name=\"alignment\">");   for (const auto& p: m_sequences)   {     std::stringstream nextline;     nextline       << "                    <sequence id=\"seq_"       << p.GetDescription()       << "\" taxon=\""       << p.GetDescription()       << "\" totalcount=\"4\" value=\""       << p.GetSequence()       << "\"/>";     ;     v.push_back(nextline.str());   }   //This is generated if CCATACGCCC is present 10x   /*                       <sequence id="seq_CCATACGCCC" taxon="CCATACGCCC" totalcount="4" value="CCATACGCCCCCATACGCCCCCATACGCCCCCATACGCCCCCATACGCCCCCATACGCCCCCATACGCCCCCATACGCCCCCATACGCCCCCATACGCCC"/>   */   // This works if all alignments are unique   /*   for (const std::string& s: m_alignments)   {     v.push_back("                    <sequence id=\"seq_" + s + "\" taxon=\"" + s + "\" totalcount=\"4\" value=\"" + s + "\"/>");   }   */   v.push_back("                </data>");   v.push_back("");   v.push_back("");   v.push_back("    ");   v.push_back("");   v.push_back("");   v.push_back("    ");   v.push_back("");   v.push_back("");   v.push_back("    ");   v.push_back("<map name=\"Beta\">beast.math.distributions.Beta</map>");   v.push_back("<map name=\"Exponential\">beast.math.distributions.Exponential</map>");   v.push_back("<map name=\"InverseGamma\">beast.math.distributions.InverseGamma</map>");   v.push_back("<map name=\"LogNormal\">beast.math.distributions.LogNormalDistributionModel</map>");   v.push_back("<map name=\"Gamma\">beast.math.distributions.Gamma</map>");   v.push_back("<map name=\"Uniform\">beast.math.distributions.Uniform</map>");   v.push_back("<map name=\"prior\">beast.math.distributions.Prior</map>");   v.push_back("<map name=\"LaplaceDistribution\">beast.math.distributions.LaplaceDistribution</map>");   v.push_back("<map name=\"OneOnX\">beast.math.distributions.OneOnX</map>");   v.push_back("<map name=\"Normal\">beast.math.distributions.Normal</map>");   v.push_back("");   v.push_back("");   const std::string mcmc_chainlength_str{std::to_string(m_mcmc_chainlength)};   assert(std::stoi(mcmc_chainlength_str) == m_mcmc_chainlength);   v.push_back("<run chainLength=\"" + mcmc_chainlength_str + "\" id=\"mcmc\" spec=\"MCMC\">");   v.push_back("    <state id=\"state\" storeEvery=\"5000\">");   v.push_back("        <tree id=\"Tree.t:" + filename_base + "\" name=\"stateNode\">");   v.push_back("            <taxonset id=\"TaxonSet." + filename_base + "\" spec=\"TaxonSet\">");   v.push_back("                <data");   v.push_back("idref=\"" + filename_base + "\"");   v.push_back("name=\"alignment\"/>");   v.push_back("            </taxonset>");   v.push_back("        </tree>");   v.push_back("        <stateNode id=\"RBcount.s:" + filename_base + "\" lower=\"0\" spec=\"parameter.IntegerParameter\" upper=\"5\">5</stateNode>");   v.push_back("        <parameter dimension=\"5\" id=\"RBrates.s:" + filename_base + "\" lower=\"0.01\" name=\"stateNode\" upper=\"100.0\">1.0</parameter>");   if (GetTreePrior() == BeastParameterFile::TreePrior::birth_death)   {     v.push_back("        <parameter id=\"birthRate2.t:" + filename_base + "\" lower=\"0.0\" name=\"stateNode\" upper=\"10000.0\">1.0</parameter>");     v.push_back("        <parameter id=\"relativeDeathRate2.t:" + filename_base + "\" lower=\"0.0\" name=\"stateNode\" upper=\"1.0\">0.5</parameter>");   }   else   {     assert(GetTreePrior() == BeastParameterFile::TreePrior::coalescent_constant_population);     v.push_back("        <parameter id=\"popSize.t:" + filename_base + "\" name=\"stateNode\">0.3</parameter>");   }   v.push_back("    </state>");   v.push_back("");   v.push_back("    <init estimate=\"false\" id=\"RandomTree.t:" + filename_base + "\" initial=\"@Tree.t:" + filename_base + "\" spec=\"beast.evolution.tree.RandomTree\" taxa=\"@" + filename_base + "\">");   v.push_back("        <populationModel id=\"ConstantPopulation0.t:" + filename_base + "\" spec=\"ConstantPopulation\">");   v.push_back("            <parameter id=\"randomPopSize.t:" + filename_base + "\" name=\"popSize\">1.0</parameter>");   v.push_back("        </populationModel>");   v.push_back("    </init>");   v.push_back("");   v.push_back("    <distribution id=\"posterior\" spec=\"util.CompoundDistribution\">");   v.push_back("        <distribution id=\"prior\" spec=\"util.CompoundDistribution\">");   if (GetTreePrior() == BeastParameterFile::TreePrior::birth_death)   {     v.push_back("            <distribution birthDiffRate=\"@birthRate2.t:" + filename_base + "\" id=\"BirthDeath.t:" + filename_base + "\" relativeDeathRate=\"@relativeDeathRate2.t:" + filename_base + "\" spec=\"beast.evolution.speciation.BirthDeathGernhard08Model\" tree=\"@Tree.t:" + filename_base + "\"/>");   }   else   {     assert(GetTreePrior() == BeastParameterFile::TreePrior::coalescent_constant_population);     v.push_back("            <distribution id=\"CoalescentConstant.t:" + filename_base + "\" spec=\"Coalescent\">");     v.push_back("                <populationModel id=\"ConstantPopulation.t:" + filename_base + "\" popSize=\"@popSize.t:" + filename_base + "\" spec=\"ConstantPopulation\"/>");     v.push_back("                <treeIntervals id=\"TreeIntervals.t:" + filename_base + "\" spec=\"TreeIntervals\" tree=\"@Tree.t:" + filename_base + "\"/>");     v.push_back("            </distribution>");   }   v.push_back("            <distribution count=\"@RBcount.s:" + filename_base + "\" id=\"RBprior.s:" + filename_base + "\" spec=\"beast.math.distributions.RBPrior\" x=\"@RBrates.s:" + filename_base + "\">");   v.push_back("                <Gamma id=\"Gamma.0\" name=\"distr\">");   v.push_back("                    <parameter id=\"RealParameter.0\" lower=\"0.0\" name=\"alpha\" upper=\"0.0\">0.2</parameter>");   v.push_back("                    <parameter id=\"RealParameter.01\" lower=\"0.0\" name=\"beta\" upper=\"0.0\">5.0</parameter>");   v.push_back("                </Gamma>");   v.push_back("            </distribution>");   if (GetTreePrior() == BeastParameterFile::TreePrior::birth_death)   {     v.push_back("            <prior id=\"BirthRatePrior.t:" + filename_base + "\" name=\"distribution\" x=\"@birthRate2.t:" + filename_base + "\">");     v.push_back("                <Uniform id=\"Uniform.0\" name=\"distr\" upper=\"1000.0\"/>");     v.push_back("            </prior>");     v.push_back("            <prior id=\"DeathRatePrior.t:" + filename_base + "\" name=\"distribution\" x=\"@relativeDeathRate2.t:" + filename_base + "\">");     v.push_back("                <Uniform id=\"Uniform.01\" name=\"distr\"/>");   }   else   {     assert(GetTreePrior() == BeastParameterFile::TreePrior::coalescent_constant_population);     v.push_back("            <prior id=\"PopSizePrior.t:" + filename_base + "\" name=\"distribution\" x=\"@popSize.t:" + filename_base + "\">");     v.push_back("                <OneOnX id=\"OneOnX.0\" name=\"distr\"/>");   }   v.push_back("            </prior>");   v.push_back("        </distribution>");   v.push_back("        <distribution id=\"likelihood\" spec=\"util.CompoundDistribution\">");   v.push_back("            <distribution data=\"@" + filename_base + "\" id=\"treeLikelihood." + filename_base + "\" spec=\"TreeLikelihood\" tree=\"@Tree.t:" + filename_base + "\">");   v.push_back("                <siteModel id=\"SiteModel.s:" + filename_base + "\" spec=\"SiteModel\">");   v.push_back("                    <parameter estimate=\"false\" id=\"mutationRate.s:" + filename_base + "\" name=\"mutationRate\">1.0</parameter>");   v.push_back("                    <parameter estimate=\"false\" id=\"gammaShape.s:" + filename_base + "\" name=\"shape\">1.0</parameter>");   v.push_back("                    <parameter estimate=\"false\" id=\"proportionInvariant.s:" + filename_base + "\" lower=\"0.0\" name=\"proportionInvariant\" upper=\"1.0\">0.0</parameter>");   v.push_back("                    <substModel count=\"@RBcount.s:" + filename_base + "\" id=\"RB.s:" + filename_base + "\" rates=\"@RBrates.s:" + filename_base + "\" spec=\"RB\">");   v.push_back("                        <frequencies data=\"@" + filename_base + "\" id=\"freqs.s:" + filename_base + "\" spec=\"Frequencies\"/>");   v.push_back("                    </substModel>");   v.push_back("                </siteModel>");   v.push_back("                <branchRateModel id=\"StrictClock.c:" + filename_base + "\" spec=\"beast.evolution.branchratemodel.StrictClockModel\">");   v.push_back("                    <parameter estimate=\"false\" id=\"clockRate.c:" + filename_base + "\" name=\"clock.rate\">1.0</parameter>");   v.push_back("                </branchRateModel>");   v.push_back("            </distribution>");   v.push_back("        </distribution>");   v.push_back("        <distribution id=\"fossilCalibrations\" spec=\"util.CompoundDistribution\"/>");   v.push_back("    </distribution>");   v.push_back("");   v.push_back("    <operator id=\"treeScaler.t:" + filename_base + "\" scaleFactor=\"0.5\" spec=\"ScaleOperator\" tree=\"@Tree.t:" + filename_base + "\" weight=\"3.0\"/>");   v.push_back("");   v.push_back("    <operator id=\"treeRootScaler.t:" + filename_base + "\" rootOnly=\"true\" scaleFactor=\"0.5\" spec=\"ScaleOperator\" tree=\"@Tree.t:" + filename_base + "\" weight=\"3.0\"/>");   v.push_back("");   v.push_back("    <operator id=\"UniformOperator.t:" + filename_base + "\" spec=\"Uniform\" tree=\"@Tree.t:" + filename_base + "\" weight=\"30.0\"/>");   v.push_back("");   v.push_back("    <operator id=\"SubtreeSlide.t:" + filename_base + "\" spec=\"SubtreeSlide\" tree=\"@Tree.t:" + filename_base + "\" weight=\"15.0\"/>");   v.push_back("");   v.push_back("    <operator id=\"narrow.t:" + filename_base + "\" spec=\"Exchange\" tree=\"@Tree.t:" + filename_base + "\" weight=\"15.0\"/>");   v.push_back("");   v.push_back("    <operator id=\"wide.t:" + filename_base + "\" isNarrow=\"false\" spec=\"Exchange\" tree=\"@Tree.t:" + filename_base + "\" weight=\"3.0\"/>");   v.push_back("");   v.push_back("    <operator id=\"WilsonBalding.t:" + filename_base + "\" spec=\"WilsonBalding\" tree=\"@Tree.t:" + filename_base + "\" weight=\"3.0\"/>");   v.push_back("");   v.push_back("    <operator count=\"@RBcount.s:" + filename_base + "\" id=\"RBOperator.s:" + filename_base + "\" rates=\"@RBrates.s:" + filename_base + "\" spec=\"RBOperator\" weight=\"1.0\"/>");   v.push_back("");   v.push_back("    <operator count=\"@RBcount.s:" + filename_base + "\" id=\"RBratescaler.s:" + filename_base + "\" parameter=\"@RBrates.s:" + filename_base + "\" scaleFactor=\"0.5\" spec=\"RBScaleOperator\" weight=\"1.0\"/>");   v.push_back("");   if (GetTreePrior() == BeastParameterFile::TreePrior::birth_death)   {     v.push_back("    <operator id=\"BirthRateScaler.t:" + filename_base + "\" parameter=\"@birthRate2.t:" + filename_base + "\" scaleFactor=\"0.75\" spec=\"ScaleOperator\" weight=\"3.0\"/>");     v.push_back("");     v.push_back("    <operator id=\"DeathRateScaler.t:" + filename_base + "\" parameter=\"@relativeDeathRate2.t:" + filename_base + "\" scaleFactor=\"0.75\" spec=\"ScaleOperator\" weight=\"3.0\"/>");   }   else   {     assert(GetTreePrior() == BeastParameterFile::TreePrior::coalescent_constant_population);     v.push_back("    <operator id=\"PopSizeScaler.t:" + filename_base + "\" parameter=\"@popSize.t:" + filename_base + "\" scaleFactor=\"0.75\" spec=\"ScaleOperator\" weight=\"3.0\"/>");   }   v.push_back("");   v.push_back("    <logger fileName=\"" + filename_base + ".log\" id=\"tracelog\" logEvery=\"1000\" model=\"@posterior\" sanitiseHeaders=\"true\" sort=\"smart\">");   v.push_back("        <log idref=\"posterior\"/>");   v.push_back("        <log idref=\"likelihood\"/>");   v.push_back("        <log idref=\"prior\"/>");   v.push_back("        <log idref=\"treeLikelihood." + filename_base + "\"/>");   v.push_back("        <log id=\"TreeHeight.t:" + filename_base + "\" spec=\"beast.evolution.tree.TreeHeightLogger\" tree=\"@Tree.t:" + filename_base + "\"/>");   v.push_back("        <log idref=\"RBcount.s:" + filename_base + "\"/>");   v.push_back("        <parameter idref=\"RBrates.s:" + filename_base + "\" name=\"log\"/>");   if (GetTreePrior() == BeastParameterFile::TreePrior::birth_death)   {     v.push_back("        <log idref=\"BirthDeath.t:" + filename_base + "\"/>");   }   else   {     assert(GetTreePrior() == BeastParameterFile::TreePrior::coalescent_constant_population);     v.push_back("        <parameter idref=\"popSize.t:" + filename_base + "\" name=\"log\"/>");     v.push_back("        <log idref=\"CoalescentConstant.t:" + filename_base + "\"/>");   }   v.push_back("    </logger>");   v.push_back("");   v.push_back("    <logger id=\"screenlog\" logEvery=\"1000\">");   v.push_back("        <log idref=\"posterior\"/>");   v.push_back("        <log arg=\"@posterior\" id=\"ESS.0\" spec=\"util.ESS\"/>");   v.push_back("        <log idref=\"likelihood\"/>");   v.push_back("        <log idref=\"prior\"/>");   v.push_back("    </logger>");   v.push_back("");   v.push_back("    <logger fileName=\"$(tree).trees\" id=\"treelog.t:" + filename_base + "\" logEvery=\"1000\" mode=\"tree\">");   v.push_back("        <log id=\"TreeWithMetaDataLogger.t:" + filename_base + "\" spec=\"beast.evolution.tree.TreeWithMetaDataLogger\" tree=\"@Tree.t:" + filename_base + "\"/>");   v.push_back("    </logger>");   v.push_back("");   v.push_back("</run>");   v.push_back("");   v.push_back("</beast>");   return v; }   std::ostream& operator<<(std::ostream& os, const BeastParameterFile file) {   const std::vector<std::string> xml{     file.ToBirthDeathXml()   };    const std::string s{     ribi::Container().ContainerToStr(xml,"\n")   };   os << s;   return os; }`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beastparameterfile\_test.cpp
---------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef NDEBUG #include "beastparameterfile.h"  #include <cassert> #include <fstream> #include <iostream> #include <sstream>  #include <QFile>  //TODO: Move FastaFile check to FastaFile::Test #include "fastafile.h"  #include "fileio.h"  void BeastParameterFile::Test() noexcept {   {     static bool is_tested {false};     if (is_tested) return;     is_tested = true;   }   const ribi::fileio::FileIo fileio;   const std::string beast_filename_birth_death_0{"birth_death_0.xml"};   const std::string beast_filename_birth_death_1{"birth_death_1.xml"};   const std::string coalescent_constant_population_0{"coalescent_constant_population_0.xml"};   const std::string coalescent_constant_population_1{"coalescent_constant_population_1.xml"};   const std::string fasta_filename_0{"test_output_0.fas"};   const std::string fasta_filename_1{"test_output_1.fas"};   const std::string log_file{"CppBeastLogFile.log"};   const std::vector<std::string> resource_filenames     =     {       beast_filename_birth_death_0,       beast_filename_birth_death_1,       coalescent_constant_population_0,       coalescent_constant_population_1,       fasta_filename_0,       fasta_filename_1,       log_file     };   //Create resources   {     for (const auto& s: resource_filenames)     {       if (!fileio.IsRegularFile(s))       {         QFile((std::string(":/CppBeast/") + s).c_str()).copy(s.c_str());       }       assert(fileio.IsRegularFile(s));     }   }   //Compare fasta_filename_0 and birth_death   {     const FastaFile fasta_file(fasta_filename_0);     const BeastParameterFile beast_file(       fasta_file.GetSequences(),       fileio.GetFileBasename(fasta_filename_0), //alignment_base_filename,       10000000,       BeastParameterFile::TreePrior::birth_death     );     const std::string temp_filename{"tmp.txt"};     {       std::ofstream f(temp_filename.c_str());       f << beast_file;     }     if (fileio.FileToVector(temp_filename) != fileio.FileToVector(beast_filename_birth_death_0))     {       std::stringstream cmd; cmd << "diff -w " << temp_filename << " " << beast_filename_birth_death_0;       const int error{std::system(cmd.str().c_str())};       if (error)       {         std::clog << __FILE__ << ": error " << error << '\n';       }     }     assert(       fileio.FileToVector(temp_filename) == fileio.FileToVector(beast_filename_birth_death_0)     );   }   //Compare fasta_filename_1 and birth_death   {     const FastaFile fasta_file(fasta_filename_1);     const BeastParameterFile beast_file(       fasta_file.GetSequences(),       fileio.GetFileBasename(fasta_filename_1),       10000000,       BeastParameterFile::TreePrior::birth_death     );     const std::string temp_filename{"tmp.txt"};     {       std::ofstream f(temp_filename.c_str());       f << beast_file;     }     if (fileio.FileToVector(temp_filename) != fileio.FileToVector(beast_filename_birth_death_1))     {       std::stringstream cmd; cmd << "diff -w " << temp_filename << " " << beast_filename_birth_death_1;       const int error{std::system(cmd.str().c_str())};       if (error)       {         std::clog << __FILE__ << ": error " << error << '\n';       }     }     assert(       fileio.FileToVector(temp_filename) == fileio.FileToVector(beast_filename_birth_death_1)     );   }   //Compare fasta_filename_0 and coalescent_constant_population   {     const FastaFile fasta_file(fasta_filename_0);     const BeastParameterFile beast_file(       fasta_file.GetSequences(),       fileio.GetFileBasename(fasta_filename_0),       10000000,       BeastParameterFile::TreePrior::coalescent_constant_population     );     const std::string temp_filename{"tmp.txt"};     {       std::ofstream f(temp_filename.c_str());       f << beast_file;     }     if (fileio.FileToVector(temp_filename) != fileio.FileToVector(coalescent_constant_population_0))     {       std::stringstream cmd; cmd << "diff " << temp_filename << " " << coalescent_constant_population_0;       const int error{std::system(cmd.str().c_str())};       if (error)       {         std::clog << __FILE__ << ": error " << error << '\n';       }     }     assert(       fileio.FileToVector(temp_filename) == fileio.FileToVector(coalescent_constant_population_0)     );   }   //Compare fasta_filename_1 and coalescent_constant_population   {     const FastaFile fasta_file(fasta_filename_1);     const BeastParameterFile beast_file(       fasta_file.GetSequences(),       fileio.GetFileBasename(fasta_filename_1),       10000000,       BeastParameterFile::TreePrior::coalescent_constant_population     );     const std::string temp_filename{"tmp.txt"};     {       std::ofstream f(temp_filename.c_str());       f << beast_file;     }     if (fileio.FileToVector(temp_filename) != fileio.FileToVector(coalescent_constant_population_1))     {       std::stringstream cmd; cmd << "diff " << temp_filename << " " << coalescent_constant_population_1;       const int error{std::system(cmd.str().c_str())};       if (error)       {         std::clog << __FILE__ << ": error " << error << '\n';       }      }     assert(       fileio.FileToVector(temp_filename) == fileio.FileToVector(coalescent_constant_population_1)     );   } } #endif`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beaststatefile.h
---------------------------

 

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef BEASTSTATEFILE_H #define BEASTSTATEFILE_H  #include <string>  ///BEAST2 state file, the results of a BEAST2 run, has a .xml.state file extension struct BeastStateFile {   BeastStateFile(const std::string& filename);    std::string GetTree() const noexcept { return m_tree; }    #ifndef NDEBUG   static void Test() noexcept;   #endif    private:    const std::string m_tree;    ///Find the tree in a file   std::string FindTree(const std::string& filename) const;    ///Find the line the tree is to be from extracted   std::string FindTreeLine(const std::string& filename) const;  };  #endif // BEASTSTATEFILE_H`
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beaststatefile.cpp
-----------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "beaststatefile.h"  #include <cassert> #include <sstream> #include <stdexcept>  #include "fileio.h"  BeastStateFile::BeastStateFile(const std::string& filename)   : m_tree{FindTree(filename)} {   #ifndef NDEBUG   Test();   #endif   if (!ribi::fileio::FileIo().IsRegularFile(filename))   {     std::stringstream s;     s << "BeastStateFile::BeastStateFile: file '" << filename << "' not found";     throw std::logic_error(s.str().c_str());   } }  std::string BeastStateFile::FindTree(const std::string& filename) const {   if (!ribi::fileio::FileIo().IsRegularFile(filename))   {     std::stringstream s;     s << "BeastStateFile::FindTree: file '" << filename << "' not found";     throw std::logic_error(s.str().c_str());   }   const std::string s{FindTreeLine(filename)};    // <statenode id='Tree.t:birthdeath_birthdeath'>[NEWICK]</statenode>   // Remove leading XML opening tag   const std::string t{s.substr(s.find('>') + 1,s.size() - s.find('>') - 1)};   // Remove trailing XML closing tag   const std::string to_remove{"</statenode>"};   const std::string u{t.substr(0,t.size() - to_remove.size())};   return u; }  std::string BeastStateFile::FindTreeLine(const std::string& filename) const {   assert(ribi::fileio::FileIo().IsRegularFile(filename));   const std::vector<std::string> v{     ribi::fileio::FileIo().FileToVector(filename)   };   // <statenode id='Tree.t:birthdeath_birthdeath'>[NEWICK]</statenode>   for (const std::string& s: v)   {     const std::string begins_with{"<statenode id='Tree.t:"};     if (s.substr(0,begins_with.size()) == begins_with) { return s; }   }   throw std::logic_error("Could not find tree line"); }`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBeast/beaststatefile\_test.cpp
-----------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef NDEBUG #include "beaststatefile.h"  #include <cassert> #include <sstream>  #include <QFile>  #include "fileio.h"   void BeastStateFile::Test() noexcept {   {     static bool is_tested {false};     if (is_tested) return;     is_tested = true;   }   const ribi::fileio::FileIo fileio;   const std::string birth_death{"birthdeath_birthdeath.xml.state"};   const std::string coalecent{"coalescent_coalescent.xml.state"};   const std::vector<std::string> resource_filenames     =     {       birth_death,       coalecent     };   //Create resources   {      for (const auto& s: resource_filenames)     {       //Delete previous version       if (fileio.IsRegularFile(s))       {         std::remove(s.c_str());         assert(!fileio.IsRegularFile(s));       }       if (!fileio.IsRegularFile(s))       {         QFile((std::string(":/files/") + s).c_str()).copy(s.c_str());       }       assert(fileio.IsRegularFile(s));     }   }   {     const BeastStateFile f(birth_death);     const std::string tree_expected{"((((0:0.6806332581800597,(1:0.14146171723485418,6:0.14146171723485418)14:0.5391715409452056)11:0.22332014485665863,(2:0.01756816581268059,5:0.01756816581268059)10:0.8863852372240377)13:2.3462146599375355,(3:2.245410556417966,7:2.245410556417966)16:1.0047575065562877)17:5.369857849107417,((4:0.8273959320640695,9:0.8273959320640695)12:1.9329777335399343,8:2.760373665604004)15:5.859652246477667)18:0.0"};     assert(f.GetTree() == tree_expected);   }   {     const BeastStateFile f(coalecent);     const std::string tree_expected{"((((0:1.9731487278617976,(2:0.02385862495086483,5:0.02385862495086483)12:1.9492901029109329)17:0.5602600580639896,(1:0.15558418773033483,6:0.15558418773033483)10:2.377824598195452)13:3.54396556997399,(3:0.8046576734483606,9:0.8046576734483606)16:5.272716682451416)11:6.921407992888125,((4:0.6362512899069979,8:0.6362512899069979)14:2.317725193372067,7:2.9539764832790647)15:10.044805865508838)18:0.0"};     assert(f.GetTree() == tree_expected);   } } #endif  /* Parameters used:    const int dna_length{20};   const double mutation_rate{0.1};   const int n_generations{1};   const int pop_size{10};   const int seed{42};  */  /* birthdeath_birthdeath.xml.state:  <itsabeastystatewerein version='2.0' sample='10000'> <statenode id='Tree.t:birthdeath_birthdeath'>((((0:0.6806332581800597,(1:0.14146171723485418,6:0.14146171723485418)14:0.5391715409452056)11:0.22332014485665863,(2:0.01756816581268059,5:0.01756816581268059)10:0.8863852372240377)13:2.3462146599375355,(3:2.245410556417966,7:2.245410556417966)16:1.0047575065562877)17:5.369857849107417,((4:0.8273959320640695,9:0.8273959320640695)12:1.9329777335399343,8:2.760373665604004)15:5.859652246477667)18:0.0</statenode> <statenode id='RBcount.s:birthdeath_birthdeath'>RBcount.s:birthdeath_birthdeath[1 1] (0,5): 0 </statenode> <statenode id='RBrates.s:birthdeath_birthdeath'>RBrates.s:birthdeath_birthdeath[5 1] (0.01,100.0): 1.159671691142549 0.3424863379792815 0.19162007658050476 0.834973477181565 0.953933440001739 </statenode> <statenode id='birthRate2.t:birthdeath_birthdeath'>birthRate2.t:birthdeath_birthdeath[1 1] (0.0,10000.0): 0.3336938635250574 </statenode> <statenode id='relativeDeathRate2.t:birthdeath_birthdeath'>relativeDeathRate2.t:birthdeath_birthdeath[1 1] (0.0,1.0): 0.08450560553928697 </statenode> </itsabeastystatewerein> <!-- {operators:[ {id:"treeScaler.t:birthdeath_birthdeath", p:0.5, accept:157, reject:210, acceptFC:0, rejectFC:0, rejectIv:0, rejectOp:0}, {id:"treeRootScaler.t:birthdeath_birthdeath", p:0.5, accept:108, reject:242, acceptFC:0, rejectFC:0, rejectIv:59, rejectOp:59}, {id:"UniformOperator.t:birthdeath_birthdeath", p:NaN, accept:2250, reject:1472, acceptFC:0, rejectFC:0, rejectIv:0, rejectOp:0}, {id:"SubtreeSlide.t:birthdeath_birthdeath", p:1.0, accept:914, reject:1003, acceptFC:0, rejectFC:0, rejectIv:447, rejectOp:447}, {id:"narrow.t:birthdeath_birthdeath", p:NaN, accept:1256, reject:647, acceptFC:0, rejectFC:0, rejectIv:0, rejectOp:0}, {id:"wide.t:birthdeath_birthdeath", p:NaN, accept:88, reject:311, acceptFC:0, rejectFC:0, rejectIv:208, rejectOp:208}, {id:"WilsonBalding.t:birthdeath_birthdeath", p:NaN, accept:57, reject:318, acceptFC:0, rejectFC:0, rejectIv:129, rejectOp:129}, {id:"RBOperator.s:birthdeath_birthdeath", p:NaN, accept:47, reject:78, acceptFC:0, rejectFC:0, rejectIv:43, rejectOp:43}, {id:"RBratescaler.s:birthdeath_birthdeath", p:0.5, accept:59, reject:66, acceptFC:0, rejectFC:0, rejectIv:32, rejectOp:32}, {id:"BirthRateScaler.t:birthdeath_birthdeath", p:0.75, accept:291, reject:69, acceptFC:0, rejectFC:0, rejectIv:0, rejectOp:0}, {id:"DeathRateScaler.t:birthdeath_birthdeath", p:0.75, accept:299, reject:59, acceptFC:0, rejectFC:0, rejectIv:1, rejectOp:1} ]} -->  */  /* Parameters used:    const int dna_length{20};   const double mutation_rate{0.1};   const int n_generations{1};   const int pop_size{10};   const int seed{42};  */  /* coalescent_coalescent.xml.state:   <itsabeastystatewerein version='2.0' sample='10000'> <statenode id='Tree.t:coalescent_coalescent'>((((0:1.9731487278617976,(2:0.02385862495086483,5:0.02385862495086483)12:1.9492901029109329)17:0.5602600580639896,(1:0.15558418773033483,6:0.15558418773033483)10:2.377824598195452)13:3.54396556997399,(3:0.8046576734483606,9:0.8046576734483606)16:5.272716682451416)11:6.921407992888125,((4:0.6362512899069979,8:0.6362512899069979)14:2.317725193372067,7:2.9539764832790647)15:10.044805865508838)18:0.0</statenode> <statenode id='RBcount.s:coalescent_coalescent'>RBcount.s:coalescent_coalescent[1 1] (0,5): 1 </statenode> <statenode id='RBrates.s:coalescent_coalescent'>RBrates.s:coalescent_coalescent[5 1] (0.01,100.0): 0.23132701641187525 1.657609536938711 0.439309067785706 0.8175615492373255 0.5083458236172506 </statenode> <statenode id='popSize.t:coalescent_coalescent'>popSize.t:coalescent_coalescent[1 1] (-Infinity,Infinity): 8.965749070849592 </statenode> </itsabeastystatewerein> <!-- {operators:[ {id:"treeScaler.t:coalescent_coalescent", p:0.5, accept:145, reject:260, acceptFC:0, rejectFC:0, rejectIv:0, rejectOp:0}, {id:"treeRootScaler.t:coalescent_coalescent", p:0.5, accept:203, reject:202, acceptFC:0, rejectFC:0, rejectIv:45, rejectOp:45}, {id:"UniformOperator.t:coalescent_coalescent", p:NaN, accept:1970, reject:1955, acceptFC:0, rejectFC:0, rejectIv:0, rejectOp:0}, {id:"SubtreeSlide.t:coalescent_coalescent", p:1.0, accept:991, reject:997, acceptFC:0, rejectFC:0, rejectIv:440, rejectOp:440}, {id:"narrow.t:coalescent_coalescent", p:NaN, accept:1245, reject:599, acceptFC:0, rejectFC:0, rejectIv:0, rejectOp:0}, {id:"wide.t:coalescent_coalescent", p:NaN, accept:81, reject:312, acceptFC:0, rejectFC:0, rejectIv:207, rejectOp:207}, {id:"WilsonBalding.t:coalescent_coalescent", p:NaN, accept:54, reject:333, acceptFC:0, rejectFC:0, rejectIv:108, rejectOp:108}, {id:"RBOperator.s:coalescent_coalescent", p:NaN, accept:50, reject:94, acceptFC:0, rejectFC:0, rejectIv:57, rejectOp:57}, {id:"RBratescaler.s:coalescent_coalescent", p:0.5, accept:43, reject:70, acceptFC:0, rejectFC:0, rejectIv:46, rejectOp:46}, {id:"PopSizeScaler.t:coalescent_coalescent", p:0.75, accept:325, reject:72, acceptFC:0, rejectFC:0, rejectIv:0, rejectOp:0} ]} -->  */`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 





 

[![Valid XHTML 1.0 Strict](valid-xhtml10.png){width="88"
height="31"}](http://validator.w3.org/check?uri=referer)

This page has been created by the [tool](Tools.htm)
[CodeToHtml](ToolCodeToHtml.htm)
