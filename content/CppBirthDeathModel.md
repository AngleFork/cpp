



 

 

 

 

 

([C++](Cpp.htm)) [BirthDeathModel](CppBirthDeathModel.htm)
==========================================================

 

![STL](PicStl.png)

 

[BirthDeathModel](CppBirthDeathModel.htm) contains some classes that are
related to the birth-death speciation model.

Technical facts
---------------

 

 

 

 

 

 

./CppBirthDeathModel/CppBirthDeathModel.pri
-------------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` INCLUDEPATH += \     ../../Classes/CppBirthDeathModel  SOURCES += \     ../../Classes/CppBirthDeathModel/birthdeathmodelsimulation.cpp \     ../../Classes/CppBirthDeathModel/birthdeathmodelparameters.cpp \     ../../Classes/CppBirthDeathModel/birthdeathmodelhelper.cpp  HEADERS  += \     ../../Classes/CppBirthDeathModel/birthdeathmodelsimulation.h \     ../../Classes/CppBirthDeathModel/birthdeathmodelparameters.h \     ../../Classes/CppBirthDeathModel/birthdeathmodelhelper.h  OTHER_FILES += \     ../../Classes/CppBirthDeathModel/Licence.txt`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBirthDeathModel/birthdeathmodelhelper.h
--------------------------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef BIRTHDEATHMODELHELPER_H #define BIRTHDEATHMODELHELPER_H  #include "rate.h" #include <vector>  namespace ribi { namespace bdm {  struct Parameters;  struct Helper {   using Rate = ribi::units::Rate;    enum class Part { phylogeny, branch_lengths };    Helper();    ///Calculate the likelihood of the candidate parameters in generating the dataset   double CalcLogLikelihood(     const std::string& newick,     const Rate& birth_rate,     const Rate& death_rate   ) const;    ///Uses DDD package   double CalcLogLikelihoodDdd(     const std::string& newick,     const Rate& birth_rate,     const Rate& death_rate,     const Part part   ) const;    ///Uses laser package   double CalcLogLikelihoodLaser(     const std::string& newick,     const Rate& birth_rate,     const Rate& death_rate   ) const;    ///Uses DDD package   void CalcMaxLikelihood(     const std::string& newick,     Rate& birth_rate,     Rate& death_rate,     const Part part = Part::phylogeny   ) const;    std::string CreateSimulatedPhylogeny(     const Parameters& parameters   ) const;    private:    #ifndef NDEBUG   static void Test() noexcept;   #endif };  } //~namespace bm } //~namespace ribi  #endif // BIRTHDEATHMODELHELPER_H`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBirthDeathModel/birthdeathmodelhelper.cpp
----------------------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "birthdeathmodelhelper.h"  #include <cassert> #include <iostream> #include <stdexcept> #include <sstream>  #include <boost/math/constants/constants.hpp>  #include "RInside.h"  #include "fileio.h" #include "testtimer.h" #include "birthdeathmodelparameters.h" #include "phylogeny_r.h" #include "trace.h" #include "ribi_rinside.h"  ribi::bdm::Helper::Helper() {   #ifndef NDEBUG   Test();   #endif }  double ribi::bdm::Helper::CalcLogLikelihood(   const std::string& newick,   const Rate& birth_rate,   const Rate& death_rate ) const {   return CalcLogLikelihoodLaser(     newick,     birth_rate,     death_rate   ); }  double ribi::bdm::Helper::CalcLogLikelihoodDdd(   const std::string& newick,   const Rate& birth_rate,   const Rate& death_rate,   const Part part ) const {   assert(!newick.empty());   auto& r = ribi::Rinside().Get();    r.parseEval("library(ape)");   r.parseEval("library(DDD)");   r["newick"] = newick;   r.parseEval("phylogeny <- read.tree(text = newick)");   r.parseEval("branch_lengths <- phylogeny$edge.length");   r["lambda"] = birth_rate.value();   r["mu"] = death_rate.value();    // model of time-dependence:   // - 0: no time dependence   // - 1: speciation and/or extinction rate is exponentially declining with time   // - 2: stepwise decline in speciation rate as in diversity-dependence without extinction   // - 3: decline in speciation rate following deterministic logistic equation for ddmodel = 1   r["model_of_time_dependence"] = 0;    // conditioning:   // - 0: conditioning on stem or crown age   // - 1: conditioning on stem or crown age and non-extinction of the phylogeny   // - 2: conditioning on stem or crown age and on the total number of extant taxa (including missing species)   // - 3: conditioning on the total number of extant taxa (including missing species)   r["conditioning"] = 1;    // Likelihood of what:   // - 0: branching times   // - 1: the phylogeny   switch (part)   {     case Part::branch_lengths: r["likelihood_of_what"] = 0; break;     case Part::phylogeny     : r["likelihood_of_what"] = 1; break;   }    // Show parameters and likelihood on screen:   // - 0: no   // - 1: yes   r["show_parameters_and_likelihood_on_screen"] = 0;    // first data point is:   // - 1: stem age   // - 2: crown age   r["first_data_point_is"] = 2;    r.parseEval(     "log_likelihood_ddd <- bd_loglik("     "  pars1 = c(lambda,mu),"     "  pars2 = c("     "    model_of_time_dependence,"     "    conditioning,"     "    likelihood_of_what,"     "    show_parameters_and_likelihood_on_screen,"     "    first_data_point_is"     "  ),"     "  brts=branch_lengths,"     "  missnumspec = 0"     ")"   );    Rcpp::DoubleVector v = r["log_likelihood_ddd"];   assert(v.size() == 1);   return v[0]; }  double ribi::bdm::Helper::CalcLogLikelihoodLaser(   const std::string& newick,   const Rate& birth_rate,   const Rate& death_rate ) const {   assert(!newick.empty());   auto& r = ribi::Rinside().Get();    r.parseEval("library(ape)");   r.parseEval("library(laser)");   r["newick"] = newick;   r.parseEval("phylogeny <- read.tree(text = newick)");   r.parseEval("branch_lengths <- phylogeny$edge.length");   r["lambda"] = birth_rate.value();   r["mu"] = death_rate.value();   Rcpp::DoubleVector v     = r.parseEval("calcLHbd(x = branch_lengths, r = lambda - mu, a = mu / lambda)"   );   assert(v.size() == 1);   return v[0]; }   void ribi::bdm::Helper::CalcMaxLikelihood(   const std::string& newick,   Rate& birth_rate,   Rate& death_rate,   const Part part ) const {   assert(!newick.empty());   auto& r = ribi::Rinside().Get();    r.parseEval("library(ape)");   r.parseEval("library(DDD)");   r["newick"] = newick;   r.parseEval("phylogeny <- read.tree(text = newick)");   r.parseEval("branch_lengths <- phylogeny$edge.length");    switch (part)   {     case Part::branch_lengths: r["part"] = 0; break;     case Part::phylogeny     : r["part"] = 1; break;   }    r.parseEval(     "max_likelihood <- bd_ML("     "  brts = branch_lengths,"     "  cond = 1," // # cond == 1 : conditioning on stem or crown age and non-extinction of the phylogeny     "  btorph = part"     ")"   );    r.parseEval("lambda0 <- max_likelihood$lambda0");   r.parseEval("mu0 <- max_likelihood$mu0");   r.parseEval("conv <- max_likelihood$conv");   const Rcpp::DoubleVector lambda0 = r["lambda0"];   const Rcpp::DoubleVector mu0 = r["mu0"];   const Rcpp::IntegerVector conv = r["conv"];   assert(lambda0.size() == 1);   assert(mu0.size() == 1);   assert(conv.size() == 1);   const bool has_converged = conv[0] == 0;   if (!has_converged)   {     std::stringstream s;     s << __func__ << ": has not converged" ;     throw std::runtime_error(s.str());   }   birth_rate = lambda0[0] / boost::units::si::second;   death_rate = mu0[0] / boost::units::si::second; }  std::string ribi::bdm::Helper::CreateSimulatedPhylogeny(   const Parameters& parameters ) const {   ribi::fileio::FileIo f;   auto& r = ribi::Rinside().Get();    r.parseEvalQ("library(ape)");   r.parseEvalQ("library(geiger)");   const double birth_rate{parameters.GetBirthRate().value()};   const double death_rate{parameters.GetDeathRate().value()};   const int n_taxa{parameters.GetNumberOfTaxa()};   const int rng_seed{parameters.GetRngSeed()};   const double t_end{parameters.GetTime().value()};    assert(t_end == 0 && "Not yet implemented running to a certain time");    r["birth_rate"] = birth_rate;   r["death_rate"] = death_rate;   r["n_taxa"] = n_taxa;   r["rng_seed"] = rng_seed;   r["t_end"] = t_end;   // /home/richel/R/i686-pc-linux-gnu-library/3.1/Rcpp/include/Rcpp/vector/Vector.h   assert(Rcpp::DoubleVector(r["birth_rate"])[0] == birth_rate);   assert(Rcpp::DoubleVector(r["death_rate"])[0] == death_rate);   assert(Rcpp::IntegerVector(r["n_taxa"])[0] == n_taxa);   assert(Rcpp::IntegerVector(r["rng_seed"])[0] == rng_seed);   assert(Rcpp::DoubleVector(r["t_end"])[0] == t_end);    //Vital! If forgotten, the branch lengths will become N/A or 0   std::setlocale(LC_ALL,"en_US.UTF-8");    r.parseEvalQ("tree_full <- sim.bdtree(b=birth_rate,d=death_rate,stop=\"taxa\",n=n_taxa,extinct=FALSE,seed=rng_seed)");   const Rcpp::String s = r.parseEval("write.tree(tree_full)");   return std::string(s); }  #ifndef NDEBUG void ribi::bdm::Helper::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   {     ribi::fileio::FileIo();     auto& r = ribi::Rinside().Get();     r.parseEval("library(ape)");     r.parseEval("library(DDD)");     r.parseEval("library(geiger)");     r.parseEval("library(laser)");   }   const TestTimer test_timer(__func__,__FILE__,1.0);    Helper h;   ribi::fileio::FileIo f;    //CreateSimulatedPhylogeny must create a newick   {     const Parameters parameters(       0.1 / boost::units::si::second,       0.0 / boost::units::si::second,       10,       42     );     assert(!h.CreateSimulatedPhylogeny(parameters).empty());   }   //CalcLogLikelihood   {     const std::string newick{"((F:2,G:2):1,H:3);"};     const Rate& birth_rate{0.20 / boost::units::si::second};     const Rate& death_rate{0.01 / boost::units::si::second};     const double log_likelihood{       h.CalcLogLikelihood(         newick,         birth_rate,         death_rate       )     };     assert(log_likelihood <= 0.0);   }   //CalcLogLikelihoodDdd and CalcLogLikelihoodLaser should give same results   {     const std::string newick{"((F:2,G:2):1,H:3);"};     const Rate& birth_rate{0.20 / boost::units::si::second};     const Rate& death_rate{0.01 / boost::units::si::second};     const double log_likelihood_ddd{       h.CalcLogLikelihoodDdd(         newick,         birth_rate,         death_rate,         Part::branch_lengths       )     };     const double log_likelihood_laser{       h.CalcLogLikelihoodLaser(         newick,         birth_rate,         death_rate       )     };     std::cout       << "log_likelihood_laser: " << log_likelihood_laser << '\n'       << "log_likelihood_ddd: " << log_likelihood_ddd << '\n'     ;      assert(abs(log_likelihood_laser - log_likelihood_ddd) < 0.0001);   }   //CalcMaxLikelihood   {     const std::string newick{"((F:2,G:2):1,H:3);"};     Rate birth_rate{0.0 / boost::units::si::second};     Rate death_rate{0.0 / boost::units::si::second};     h.CalcMaxLikelihood(       newick,       birth_rate,       death_rate,       Part::phylogeny     );     assert(birth_rate > 0.0 / boost::units::si::second);     assert(death_rate > 0.0 / boost::units::si::second);   } } #endif`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBirthDeathModel/birthdeathmodelparameters.h
------------------------------------------------

 

  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef BIRTHDEATHMODELPARAMETERS_H #define BIRTHDEATHMODELPARAMETERS_H  #include "rate.h" #include "ribi_time.h"  namespace ribi { namespace bdm {  ///Performs a Birth-Death process struct Parameters {   using BirthRate = ribi::units::Rate;   using DeathRate = ribi::units::Rate;   using Time = ribi::units::Time;    Parameters(     const BirthRate birth_rate,     const DeathRate death_rate,     const Time time,     const int rng_seed = 42   );    Parameters(     const BirthRate birth_rate,     const DeathRate death_rate,     const int n_taxa,     const int rng_seed = 42   );    auto GetBirthRate() const noexcept { return m_birth_rate; }   auto GetDeathRate() const noexcept { return m_death_rate; }   auto GetNumberOfTaxa() const noexcept { return m_n_taxa; }   auto GetRngSeed() const noexcept { return m_rng_seed; }   auto GetTime() const noexcept { return m_time; }    private:   const BirthRate m_birth_rate;   const DeathRate m_death_rate;   const int m_rng_seed;   const Time m_time;   const int m_n_taxa; };  } //~namespace bm } //~namespace ribi  #endif // BIRTHDEATHMODELPARAMETERS_H`
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBirthDeathModel/birthdeathmodelparameters.cpp
--------------------------------------------------

 

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "birthdeathmodelparameters.h"  #include <sstream> #include <stdexcept>  ribi::bdm::Parameters::Parameters(     const BirthRate birth_rate,     const DeathRate death_rate,     const Time time,     const int rng_seed ) :     m_birth_rate{birth_rate},     m_death_rate{death_rate},     m_rng_seed{rng_seed},     m_time{time},     m_n_taxa{0} {   if (m_birth_rate < 0.0 / boost::units::si::second)   {     std::stringstream s;     s << __func__       << ": birth_rate must be positive, "       << "value given is " << m_birth_rate     ;     throw std::logic_error(s.str());   }   if (m_death_rate < 0.0 / boost::units::si::second)   {     std::stringstream s;     s << __func__       << ": death_rate must be positive, "       << "value given is " << m_death_rate     ;     throw std::logic_error(s.str());   }   if (m_time < 0.0 * boost::units::si::second)   {     std::stringstream s;     s << __func__       << ": time must be positive, "       << "value given is " << m_time     ;     throw std::logic_error(s.str());   }  }  ribi::bdm::Parameters::Parameters(     const BirthRate birth_rate,     const DeathRate death_rate,     const int n_taxa,     const int rng_seed ) :     m_birth_rate{birth_rate},     m_death_rate{death_rate},     m_rng_seed{rng_seed},     m_time{0.0 * boost::units::si::second},     m_n_taxa{n_taxa} {   if (m_birth_rate < 0.0 / boost::units::si::second)   {     std::stringstream s;     s << __func__       << ": birth_rate must be positive, "       << "value given is " << m_birth_rate     ;     throw std::logic_error(s.str());   }   if (m_death_rate < 0.0 / boost::units::si::second)   {     std::stringstream s;     s << __func__       << ": death_rate must be positive, "       << "value given is " << m_death_rate     ;     throw std::logic_error(s.str());   }   if (m_n_taxa < 2)   {     std::stringstream s;     s << __func__       << ": n_taxa must be 2 at least, "       << "value given is " << m_n_taxa     ;     throw std::logic_error(s.str());   }  }`
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBirthDeathModel/birthdeathmodelsimulation.h
------------------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #ifndef BIRTHDEATHMODELPROCESS_H #define BIRTHDEATHMODELPROCESS_H  #include "birthdeathmodelparameters.h" #include <random>  namespace ribi { namespace bdm {  ///Performs a Brownian motion struct Simulation {   using BirthRate = ribi::units::Rate;   using DeathRate = ribi::units::Rate;   using Time = ribi::units::Time;    Simulation(     const Parameters& parameters   );    ///Calculate the next x. This class will supply the random numbers,   ///thus these member functions are not const   void CalcNext(     const double x   );    ///Calculate the next x+dt, supplying the random numbers yourself   void CalcNext(     const double x,     const double random_exponential   );    int CountExtant() const noexcept;    #ifndef NDEBUG   static void Test() noexcept;   #endif    private:   std::exponential_distribution<double> m_exponential_distribution;   const Parameters m_parameters;   std::mt19937 m_rng;   Time m_time;   std::uniform_real_distribution<double> m_uniform_distribution; };  } //~namespace bm } //~namespace ribi  #endif // BIRTHDEATHMODELPROCESS_H`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppBirthDeathModel/birthdeathmodelsimulation.cpp
--------------------------------------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` #include "birthdeathmodelsimulation.h"  #include <cassert> #include <cmath> #include <iostream> #include <stdexcept> #include <sstream>  #include "birthdeathmodelhelper.h" #include <boost/math/constants/constants.hpp>  #include "testtimer.h"  ribi::bdm::Simulation::Simulation(   const Parameters& parameters )   : m_exponential_distribution(parameters.GetBirthRate().value() + parameters.GetDeathRate().value()),     m_parameters{parameters},     m_rng(parameters.GetRngSeed()),     m_time{0.0 * boost::units::si::second},     m_uniform_distribution(0.0,1.0) {   #ifndef NDEBUG   Test();   #endif }  void ribi::bdm::Simulation::CalcNext(const double x) {   const double r{     CountExtant()     * (m_parameters.GetBirthRate().value() + m_parameters.GetDeathRate().value())   };   if (r != m_exponential_distribution.lambda())   {     m_exponential_distribution = std::exponential_distribution<double>(r);   }    const double random_exponential{m_exponential_distribution(m_rng)};   return CalcNext(x,random_exponential); }  void ribi::bdm::Simulation::CalcNext(   const double /* x */,   const double random_exponential ) {   const auto dt = random_exponential * boost::units::si::second;   m_time += dt;   //Do something with a phylogeny here   //Stub }   int ribi::bdm::Simulation::CountExtant() const noexcept {   return 0; //Stub }  #ifndef NDEBUG void ribi::bdm::Simulation::Test() noexcept {   {     static bool is_tested{false};     if (is_tested) return;     is_tested = true;   }   {     Helper();   }   const TestTimer test_timer(__func__,__FILE__,1.0); } #endif`
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 





 




This page has been created by the [tool](Tools.htm)
[CodeToHtml](ToolCodeToHtml.htm)
