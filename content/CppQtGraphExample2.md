

[Go back to Richel Bilderbeek's C++ page](Cpp.htm).

 

 

 

 

 

([C++](Cpp.htm)) [QtGraphExample2](CppQtGraphExample2.htm)
==========================================================

 

Technical facts
---------------

 

[Operating system(s) or programming environment(s)](CppOs.htm)

-   ![Lubuntu](PicLubuntu.png) [Lubuntu](CppLubuntu.htm) 15.04 (vivid)

[IDE(s)](CppIde.htm):

-   ![Qt Creator](PicQtCreator.png) [Qt Creator](CppQtCreator.htm) 3.1.1

[Project type](CppQtProjectType.htm):

-   ![console](PicConsole.png) [Console
    application](CppConsoleApplication.htm)

[C++ standard](CppStandard.htm):

-   ![C++98](PicCpp98.png) [C++98](Cpp98.htm)

[Compiler(s)](CppCompiler.htm):

-   [G++](CppGpp.htm) 4.9.2

[Libraries](CppLibrary.htm) used:

-   ![STL](PicStl.png) [STL](CppStl.htm): GNU ISO C++ Library, version
    4.9.2

 

 

 

 

 

[Qt project file](CppQtProjectFile.htm): ./CppQtGraphExample2/CppQtGraphExample2.pro
------------------------------------------------------------------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` include(../../DesktopApplication.pri) include(../../Libraries/Boost.pri)  SOURCES += \     edge.cpp \     graphwidget.cpp \     main.cpp \     node.cpp  HEADERS += \     edge.h \     graphwidget.h \     node.h`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample2/edge.h
---------------------------

 

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #ifndef EDGE_H #define EDGE_H  #include <QGraphicsItem>  class Node;  class Edge : public QGraphicsItem { public:   Edge(Node * const sourceNode, Node * const destNode);   Edge(const Edge&) = delete;   Edge& operator=(const Edge&) = delete;    Node *sourceNode() const noexcept;   Node *destNode() const noexcept;    void adjust();    enum { Type = UserType + 2 };   int type() const { return Type; }  protected:   QRectF boundingRect() const;   void paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *widget);  private:   Node * const m_source_node;   Node * const m_dest_node;    QPointF m_source_point;   QPointF m_dest_point;   const double m_arrow_size; };   #endif`
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample2/edge.cpp
-----------------------------

 

  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html #include <QPainter>  #include "edge.h" #include "node.h"  #include <boost/math/constants/constants.hpp>  Edge::Edge(Node * const sourceNode, Node * const destNode)   :     m_source_node{sourceNode},     m_dest_node{destNode},     m_source_point{0.0,0.0},     m_dest_point{0.0,0.0},     m_arrow_size{10.0} {   setAcceptedMouseButtons(0);   m_source_node->addEdge(this);   m_dest_node->addEdge(this);   adjust(); }  Node * Edge::sourceNode() const noexcept {   return m_source_node; }  Node * Edge::destNode() const noexcept {   return m_dest_node; }  void Edge::adjust() {   if (!m_source_node || !m_dest_node) return;    const QLineF line(mapFromItem(m_source_node, 0, 0), mapFromItem(m_dest_node, 0, 0));   const double length{line.length()};    prepareGeometryChange();    if (length > 20.0)   {     const QPointF edgeOffset((line.dx() * 10) / length, (line.dy() * 10) / length);     m_source_point = line.p1() + edgeOffset;     m_dest_point = line.p2() - edgeOffset;   }   else   {     m_source_point = m_dest_point = line.p1();   } }  QRectF Edge::boundingRect() const {   if (!m_source_node || !m_dest_node) return QRectF();    const double penWidth{1.0};   const double extra{(penWidth + m_arrow_size) / 2.0};    return QRectF(     m_source_point,     QSizeF(m_dest_point.x() - m_source_point.x(),       m_dest_point.y() - m_source_point.y()     )   ).normalized()    .adjusted(-extra, -extra, extra, extra); }  void Edge::paint(QPainter *painter, const QStyleOptionGraphicsItem *, QWidget *) {   if (!m_source_node || !m_dest_node) return;    const double pi{boost::math::constants::pi<double>()};   const double tau{boost::math::constants::two_pi<double>()};     const QLineF line(m_source_point, m_dest_point);    if (qFuzzyCompare(line.length(), 0.0)) return;    // Draw the line itself   painter->setPen(QPen(Qt::black, 1.0, Qt::SolidLine, Qt::RoundCap, Qt::RoundJoin));   painter->drawLine(line);    // Draw the arrows   double angle = std::acos(line.dx() / line.length());   if (line.dy() >= 0) angle = tau - angle;    using std::sin;   using std::cos;   const QPointF sourceArrowP1{m_source_point + QPointF(sin(angle + pi / 3.0) * m_arrow_size,cos(angle + pi / 3.0) * m_arrow_size)};   const QPointF sourceArrowP2{m_source_point + QPointF(sin(angle + pi - pi / 3.0) * m_arrow_size,cos(angle + pi - pi / 3.0) * m_arrow_size)};   const QPointF destArrowP1{m_dest_point + QPointF(sin(angle - pi / 3.0) * m_arrow_size,cos(angle - pi / 3.0) * m_arrow_size)};   const QPointF destArrowP2{m_dest_point + QPointF(sin(angle - pi + pi / 3.0) * m_arrow_size,cos(angle - pi + pi / 3.0) * m_arrow_size)};    painter->setBrush(Qt::black);   painter->drawPolygon(QPolygonF() << line.p1() << sourceArrowP1 << sourceArrowP2);   painter->drawPolygon(QPolygonF() << line.p2() << destArrowP1 << destArrowP2); }`
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample2/graphwidget.h
----------------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #ifndef GRAPHWIDGET_H #define GRAPHWIDGET_H  #include <QGraphicsView>  class Node;  class GraphWidget : public QGraphicsView {   Q_OBJECT  public:   GraphWidget(QWidget *parent = 0);   GraphWidget(const GraphWidget&) = delete;   GraphWidget& operator=(const GraphWidget&) = delete;    void itemMoved();  public slots:   void shuffle();   void zoomIn();   void zoomOut();  protected:   void keyPressEvent(QKeyEvent *event);   void timerEvent(QTimerEvent *event);   void wheelEvent(QWheelEvent *event);   void scaleView(qreal scaleFactor);  private:   int m_timer_id;   Node * const m_center_node; };  #endif`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample2/graphwidget.cpp
------------------------------------

 

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #include "graphwidget.h" #include "edge.h" #include "node.h"  #include <QtGui>  #include <math.h>  GraphWidget::GraphWidget(QWidget *parent) : QGraphicsView(parent),   m_timer_id{0},   m_center_node{new Node(this)} {   QGraphicsScene * const scene = new QGraphicsScene(this);   scene->setItemIndexMember function(QGraphicsScene::NoIndex);   //Make the scene infinitely large   //scene->setSceneRect(-200, -200, 400, 400);   setScene(scene);   setCacheMode(CacheBackground);   setViewportUpdateMode(BoundingRectViewportUpdate);   setRenderHint(QPainter::Antialiasing);   setTransformationAnchor(AnchorUnderMouse);   scale(0.8, 0.8);   setMinimumSize(400, 400);   setWindowTitle(tr("Elastic Nodes"));    Node * const node1{new Node(this)};   Node * const node2{new Node(this)};   Node * const node3{new Node(this)};   Node * const node4{new Node(this)};   Node * const node6{new Node(this)};   Node * const node7{new Node(this)};   Node * const node8{new Node(this)};   Node * const node9{new Node(this)};   scene->addItem(node1);   scene->addItem(node2);   scene->addItem(node3);   scene->addItem(node4);   scene->addItem(m_center_node);   scene->addItem(node6);   scene->addItem(node7);   scene->addItem(node8);   scene->addItem(node9);   scene->addItem(new Edge(node1, node2));   scene->addItem(new Edge(node2, node3));   scene->addItem(new Edge(node2, m_center_node));   scene->addItem(new Edge(node3, node6));   scene->addItem(new Edge(node4, node1));   scene->addItem(new Edge(node4, m_center_node));   scene->addItem(new Edge(m_center_node, node6));   scene->addItem(new Edge(m_center_node, node8));   scene->addItem(new Edge(node6, node9));   scene->addItem(new Edge(node7, node4));   scene->addItem(new Edge(node8, node7));   scene->addItem(new Edge(node9, node8));    node1->setPos(-50, -50);   node2->setPos(0, -50);   node3->setPos(50, -50);   node4->setPos(-50, 0);   m_center_node->setPos(0, 0);   node6->setPos(50, 0);   node7->setPos(-50, 50);   node8->setPos(0, 50);   node9->setPos(50, 50); }  void GraphWidget::itemMoved() {   if (!m_timer_id)   {     m_timer_id = startTimer(1000 / 25);   } }  void GraphWidget::keyPressEvent(QKeyEvent *event) {   switch (event->key())   {     case Qt::Key_Up:       m_center_node->moveBy(0, -20);     break;     case Qt::Key_Down:       m_center_node->moveBy(0, 20);     break;     case Qt::Key_Left:       m_center_node->moveBy(-20, 0);     break;     case Qt::Key_Right:       m_center_node->moveBy(20, 0);     break;     case Qt::Key_Plus:       zoomIn();     break;     case Qt::Key_Minus:       zoomOut();     break;     case Qt::Key_Space:     case Qt::Key_Enter:       shuffle();     break;     default:       QGraphicsView::keyPressEvent(event);   } }  void GraphWidget::timerEvent(QTimerEvent *) {     QList<Node *> nodes;   foreach (QGraphicsItem *item, scene()->items())   {     if (Node * const node = qgraphicsitem_cast<Node *>(item))     {       nodes << node;     }   }   foreach (Node * const node, nodes)   {     node->calculateForces();   }    bool itemsMoved = false;   foreach (Node * const node, nodes)   {     if (node->advance())     itemsMoved = true;   }    if (!itemsMoved)   {     killTimer(m_timer_id);     m_timer_id = 0;   } }  void GraphWidget::wheelEvent(QWheelEvent *event) {   scaleView(std::pow(2.0, -event->delta() / 240.0)); }  void GraphWidget::scaleView(qreal scaleFactor) {   const double factor{     transform().scale(scaleFactor, scaleFactor)       .mapRect(QRectF(0.0, 0.0, 1.0, 1.0)).width()   };   if (factor < 0.07 || factor > 100.0) return;    scale(scaleFactor, scaleFactor); }  void GraphWidget::shuffle() {   foreach (QGraphicsItem * const item, scene()->items())   {     if (qgraphicsitem_cast<Node *>(item))     {       item->setPos(         static_cast<double>(-150 + (qrand() % 300)),         static_cast<double>(-150 + (qrand() % 300))       );     }   } }  void GraphWidget::zoomIn() {   scaleView(1.2); }  void GraphWidget::zoomOut() {   scaleView(1.0/1.2); }`
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample2/main.cpp
-----------------------------

 

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #include <QApplication>  #include "graphwidget.h"  int main(int argc, char **argv) {   QApplication app(argc, argv);   GraphWidget * const widget{new GraphWidget};   widget->show();   return app.exec(); }`
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample2/node.h
---------------------------

 

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html #ifndef NODE_H #define NODE_H  #include <QGraphicsItem> #include <QList>  class Edge; class GraphWidget; class QGraphicsSceneMouseEvent;  class Node : public QGraphicsItem { public:   Node(GraphWidget *graphWidget);   Node(const Node&) = delete;   Node& operator=(const Node&) = delete;    void addEdge(Edge *edge);   QList<Edge *> edges() const;    enum { Type = UserType + 1 };   int type() const { return Type; }    void calculateForces();   bool advance();    QRectF boundingRect() const;   QPainterPath shape() const;   void paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *widget);    protected:   QVariant itemChange(GraphicsItemChange change, const QVariant &value);    void mousePressEvent(QGraphicsSceneMouseEvent *event);   void mouseReleaseEvent(QGraphicsSceneMouseEvent *event);    private:   QList<Edge*> m_edges;   QPointF m_new_pos;   GraphWidget * const m_graph; };  #endif`
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

./CppQtGraphExample2/node.cpp
-----------------------------

 

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  ` // Adapted from Qt example 'Elastic nodes' // http://qt-project.org/doc/qt-4.8/graphicsview-elasticnodes.html  #include <QGraphicsScene> #include <QGraphicsSceneMouseEvent> #include <QPainter> #include <QStyleOption>  #include "edge.h" #include "node.h" #include "graphwidget.h"  Node::Node(GraphWidget *graphWidget)   :     m_edges{},     m_new_pos{},     m_graph(graphWidget) {   setFlag(ItemIsMovable);   setFlag(ItemSendsGeometryChanges);   setCacheMode(DeviceCoordinateCache);   setZValue(-1); }  void Node::addEdge(Edge *edge) {   m_edges << edge;   edge->adjust(); }  QList<Edge *> Node::edges() const {   return m_edges; }  void Node::calculateForces() {   if (!scene() || scene()->mouseGrabberItem() == this)   {     m_new_pos = pos();     return;   }    // Sum up all forces pushing this item away   double xvel = 0.0;   double yvel = 0.0;   foreach (QGraphicsItem *item, scene()->items())   {     Node * const node = qgraphicsitem_cast<Node *>(item);      if (!node) continue;      const QPointF vec{mapToItem(node, 0.0, 0.0)};     const double dx{vec.x()};     const double dy{vec.y()};     const double l{2.0 * (dx * dx + dy * dy)};     if (l > 0.0)     {       xvel += (dx * 150.0) / l;       yvel += (dy * 150.0) / l;     }   }    // Now subtract all forces pulling items together   const double weight = static_cast<double>(m_edges.size() + 1) * 10.0;   foreach (Edge *edge, m_edges)   {     const QPointF vec       = edge->sourceNode() == this       ? mapToItem(edge->destNode(), 0, 0)       : mapToItem(edge->sourceNode(), 0, 0)     ;     xvel -= vec.x() / weight;     yvel -= vec.y() / weight;   }    if (qAbs(xvel) < 0.1 && qAbs(yvel) < 0.1)   {     xvel = yvel = 0.0;   }    const QRectF sceneRect = scene()->sceneRect();   m_new_pos = pos() + QPointF(xvel, yvel);   m_new_pos.setX(qMin(qMax(m_new_pos.x(), sceneRect.left() + 10), sceneRect.right() - 10));   m_new_pos.setY(qMin(qMax(m_new_pos.y(), sceneRect.top() + 10), sceneRect.bottom() - 10)); }  bool Node::advance() {   if (m_new_pos == pos()) return false;    setPos(m_new_pos);   return true; }  QRectF Node::boundingRect() const {   const double adjust{2.0};   return QRectF(     -10.0 - adjust,     -10.0 - adjust,      23.0 + adjust,      23.0 + adjust    ); }  QPainterPath Node::shape() const {   QPainterPath path;   path.addEllipse(-10.0, -10.0, 20.0, 20.0);   return path; }  void Node::paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *) {   painter->setPen(Qt::NoPen);   painter->setBrush(Qt::darkGray);   painter->drawEllipse(-7, -7, 20, 20);    QRadialGradient gradient(-3, -3, 10);   if (option->state & QStyle::State_Sunken)   {     gradient.setCenter(3, 3);     gradient.setFocalPoint(3, 3);     gradient.setColorAt(1, QColor(Qt::yellow).light(120));     gradient.setColorAt(0, QColor(Qt::darkYellow).light(120));   }   else   {     gradient.setColorAt(0, Qt::yellow);     gradient.setColorAt(1, Qt::darkYellow);   }   painter->setBrush(gradient);    painter->setPen(QPen(Qt::black, 0));   painter->drawEllipse(-10, -10, 20, 20); }  QVariant Node::itemChange(GraphicsItemChange change, const QVariant &value) {   switch (change) {     case ItemPositionHasChanged:     {       foreach (Edge *edge, m_edges)       edge->adjust();       m_graph->itemMoved();     }     break;     default:     break;   }    return QGraphicsItem::itemChange(change, value); }  void Node::mousePressEvent(QGraphicsSceneMouseEvent *event) {   update();   QGraphicsItem::mousePressEvent(event); }  void Node::mouseReleaseEvent(QGraphicsSceneMouseEvent *event) {   update();   QGraphicsItem::mouseReleaseEvent(event); }`
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 

 

 

 

 

[Go back to Richel Bilderbeek's C++ page](Cpp.htm).



 

[![Valid XHTML 1.0 Strict](valid-xhtml10.png){width="88"
height="31"}](http://validator.w3.org/check?uri=referer)

This page has been created by the [tool](Tools.htm)
[CodeToHtml](ToolCodeToHtml.htm)
